<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Deciphering Life: One Bit at a Time</title>
<link>https://rmflight.github.io/index.html</link>
<atom:link href="https://rmflight.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.2.269</generator>
<lastBuildDate>Thu, 08 Dec 2022 05:00:00 GMT</lastBuildDate>
<item>
  <title>Customizing the Displayed Date in Quarto Pubs</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-12-08-customizing-the-displayed-date-in-quarto-pubs/index.html</link>
  <description><![CDATA[ 




<p>If you want to change how the date is displayed in your <code>{quarto}</code> documents, this is handy.</p>
<p>One, decide <strong>what</strong> <a href="https://quarto.org/docs/authoring/title-blocks.html#date">date</a> you want included:</p>
<ul>
<li>now</li>
<li>today</li>
<li>last-modified (this is my favorite, because I can tell if I’ve got the most recent version)</li>
</ul>
<p>Then, you can change how the date is displayed using the <code>date-format</code> <a href="https://quarto.org/docs/reference/dates.html">option</a>.</p>
<p>My personal preference is for something like 2022-12-08 13:42, to avoid any ambiguity when I’m generating reports for others.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">date</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> last-modified</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">date-format</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> YYYY-MM-DD HH:mm</span></span>
<span id="cb1-4"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Customizing the {Displayed} {Date} in {Quarto} {Pubs}},
  date = {2022-12-08},
  url = {https://rmflight.github.io/posts/2022-12-08-customizing-the-displayed-date-in-quarto-pubs},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Customizing the Displayed Date in Quarto
Pubs.”</span> December 8, 2022. <a href="https://rmflight.github.io/posts/2022-12-08-customizing-the-displayed-date-in-quarto-pubs">https://rmflight.github.io/posts/2022-12-08-customizing-the-displayed-date-in-quarto-pubs</a>.
</div></div></section></div> ]]></description>
  <category>quarto</category>
  <category>R</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2022-12-08-customizing-the-displayed-date-in-quarto-pubs/index.html</guid>
  <pubDate>Thu, 08 Dec 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Measuring Changes in Height Over Time</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/index.html</link>
  <description><![CDATA[ 




<section id="why-measure-height-over-time" class="level2">
<h2 class="anchored" data-anchor-id="why-measure-height-over-time">Why Measure Height Over Time?</h2>
<p>I have a possibly really weird theory, that I’ve not been able to find any literature on. I think that over the course of a full menstrual cycle, that some women’s height changes. The reason I think this happens, is that my spouse and I are almost exactly the same height, 99% of the time we look at each other directly in the eyes. However, there are regularly certain days of the month when we both notice that she is either slightly taller or slightly shorter than usual.</p>
<p>So, it would be really, really cool if we could record heights daily and see if it changes in any measurable way. Even neater would be if we could get a <strong>large sample</strong> of people at various life stages and genders to measure their height daily and compare amongst all of them to see if this change in height is specific to people who are regularly menstruating.</p>
</section>
<section id="ideal-method" class="level2">
<h2 class="anchored" data-anchor-id="ideal-method">Ideal Method</h2>
<p>Ideally we need to be able to do this anywhere in the world, and people should be able to do it themselves, without needing a partner or to travel anywhere. If we can do it with photos that do not involve taking a photo of the person themselves, nor use any other photo data except the date the photo was taken (if we want to be able to line up changes in height with stages of the menstrual cycle), that would also be ideal to help protect participants identity.</p>
</section>
<section id="what-i-came-up-with" class="level2">
<h2 class="anchored" data-anchor-id="what-i-came-up-with">What I Came Up With</h2>
<p>Just FYI, last winter I tried a method that involved printed lines on paper, selfies, and eye detection using OpenCV. It was a total bust.</p>
<p>A month ago, I was hashing this over in my mind again, and realized if only we could get someone else to measure people with a mark on the wall every day it might possibly work. And then I realized that if there were permanent marks on the wall (using permanent marker), and the person marked their own height with a pencil in between them, then the pencil mark location in between the two lines might possibly be used to detect changes in height.</p>
<p>Figure&nbsp;1 shows me measuring my own height, and Figure&nbsp;2 an actual photo of one of my own pencil marks to test this on the right.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-making-marks" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/hcc_making_a_mark_lores.jpg" class="img-fluid figure-img" width="1632"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Author taking a selfie while pretending to mark their own height.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-example-mark" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/hcc_example_lores.jpg" class="img-fluid figure-img" width="888"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: An actual height mark on the wall.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="testing-it" class="level2">
<h2 class="anchored" data-anchor-id="testing-it">Testing It</h2>
<p>To test the idea, I bought some relatively thin pegboard that has a thickness of 4mm (see Figure&nbsp;3). I then marked my own height 4 times, with no pegboard (0), 1 (4 mm), and 2 (8 mm). Each marking was a full replicate of:</p>
<ul>
<li>standing up against the wall,</li>
<li>making a pencil mark,</li>
<li>moving away from the wall,</li>
<li>taking a photo,</li>
<li>erasing the pencil mark,</li>
<li>repeat</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pegboard" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/hcc_lifts_lores.jpg" class="img-fluid figure-img" width="2016"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: The pegboard I used to vary my own height.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I then cropped the photos to just include the pencil mark and the lines, and then used <code>{stringr}</code> to generate random names for each of the photos so I wouldn’t know which height photo I was annotating.</p>
<p>For this test, I opened each photo in <a href="https://glimpse-editor.org/">Glimpse</a>, and measured the distance in pixels from the pencil mark to the top line, and then the pencil mark to the bottom line using the measure tool, and recorded them in an quarto-doc.</p>
<p>Finally, I calculated the ratio of the distances in pixels between the top and bottom measured values.</p>
<p>Figure&nbsp;4 shows the distributions for each height. We can see that there is a fair bit of variance in the ratios of top / bottom distances, however, the variance <strong>between</strong> heights is larger than the variance <strong>within</strong> heights, even at a difference of 4mm.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ratios" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/hcc_ratios.png" class="img-fluid figure-img" width="1200"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Plot of top to bottom distance ratios for the three heights, with 4 replicate measurements for each height.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Therefore, I think this is doable. Even more so, if the lines are made a standard distance apart (say 5 cm or 2 in), then we should be able to calculate <strong>actuall</strong> changes in height. And I think we could easily make a Shiny app that loads a photo, and records three mouse clicks to annotate the top line location, height location, and bottom location, making it easier to extract measurements from a given photo.</p>
<p>So people anywhere in the world, with at least a digital camera, could make the permanent lines, self measure using a pencil and photograph every day (erasing the pencil mark). We could use a form to upload their photos, and then take information on reproductive status, age, and dates of menses (if they are open to providing them). To do this right we would want people of various genders / sexes, and at multiple stages of life: pre-pubescent, puberty, pregnant, with and without birth control, post-menopausal, etc.</p>
<p>I’m open to other ideas, but I think Figure&nbsp;4 shows that it could possibly work. I do plan to try taking my own height and my spouses (peri-menopausal) for a couple of months and see what we get for preliminary data.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Measuring {Changes} in {Height} {Over} {Time}},
  date = {2022-12-07},
  url = {https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Measuring Changes in Height Over
Time.”</span> December 7, 2022. <a href="https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time">https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>development</category>
  <category>citizen-science</category>
  <category>height</category>
  <guid>https://rmflight.github.io/posts/2022-12-07-measuring-changes-in-height-over-time/index.html</guid>
  <pubDate>Wed, 07 Dec 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Using Academicons in Your Quarto Blog</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-12-03-using-academicons-in-your-quarto-blog/index.html</link>
  <description><![CDATA[ 




<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR</h2>
<p>Install the academicons extension in your Quarto project, and then use the “text” option.</p>
</section>
<section id="academicons" class="level2">
<h2 class="anchored" data-anchor-id="academicons">Academicons??</h2>
<p><a href="https://jpswalsh.github.io/academicons/">Academicons</a> are an awesome set of academic project themed icons in the same spirit as the <a href="https://github.com/FortAwesome/Font-Awesome">Font-Awesome</a> icon collection. In particular, they include a variety of icons related to various academic projects and software. The one I really wanted access to, was the ORCID icon, <i class="ai  ai-orcid" title="" style="color:"></i>.</p>
</section>
<section id="using-in-quarto" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-in-quarto">Using in Quarto</h2>
<p>You can download the academicons for use in Latex, HTML, and also in Quarto projects.</p>
<p>For quarto in particular, you need to <strong>install the extension in the particular project!</strong></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>I was using the instructions on the academicons site, and didn’t see that I needed to <code>cd</code> into my blog directory first to have the extension installed into the project. I do appreciate that the default for quarto is on a project basis.</p>
</div></div><pre><code>cd myblog
quarto install extension schochastics/academicons</code></pre>
<p>Then including any of the academicons in your document is easily accomplished using the short codes, like we can include the ORCID icon <i class="ai  ai-orcid" title="" style="color:"></i> using:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode md code-with-copy"><code class="sourceCode markdown"><span id="cb2-1">{{&lt; source icon &gt;}}</span></code></pre></div>
<p>where <code>source = ai</code> and <code>icon = orcid</code> or whatever other icon you want to use.</p>
</section>
<section id="including-the-icon-in-navbar" class="level2">
<h2 class="anchored" data-anchor-id="including-the-icon-in-navbar">Including the Icon in Navbar</h2>
<p>It’s often nice to include various icons in the navigation bar (navbar) or footer of your site. If you want to use it in the navbar, you will have to use</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="co" style="color: #5E5E5E;"># this would be an item under the navbar</span></span>
<span id="cb3-2"><span class="at" style="color: #657422;">  </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> </span><span class="fu" style="color: #4758AB;">text</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"{{&lt; source icon &gt;}}"</span></span>
<span id="cb3-3"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">href</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> link</span></span></code></pre></div>
<p>I hope this helps someone else!</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Using {Academicons} in {Your} {Quarto} {Blog}},
  date = {2022-12-03},
  url = {https://rmflight.github.io/posts/2022-12-03-using-academicons-in-your-quarto-blog},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Using Academicons in Your Quarto
Blog.”</span> December 3, 2022. <a href="https://rmflight.github.io/posts/2022-12-03-using-academicons-in-your-quarto-blog">https://rmflight.github.io/posts/2022-12-03-using-academicons-in-your-quarto-blog</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>quarto</category>
  <guid>https://rmflight.github.io/posts/2022-12-03-using-academicons-in-your-quarto-blog/index.html</guid>
  <pubDate>Sat, 03 Dec 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Creating an Analysis With a targets Workflow</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-09-27-creating-an-analysis-using-targets/index.html</link>
  <description><![CDATA[ 




<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR</h2>
<p>Setting up an analysis workflow using <code>{targets}</code> can be a little confusing without worked examples. This is my attempt to provide such an example.</p>
</section>
<section id="example-repo" class="level2">
<h2 class="anchored" data-anchor-id="example-repo">Example Repo</h2>
<p>I’ve set up a <a href="https://github.com/rmflight/example_targets_workflow">GitHub repo</a> that contains the data and scripts used for this analysis.</p>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>For this example, if you want to follow along yourself, you will need Miles McBain’s <code>{tflow}</code> package, which sets up an opinionated but loose directory / file structure. You will also need the <code>{targets}</code> package, and <code>{tarchetypes}</code>, and <code>{rmarkdown}</code>, as well as a few others.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">install.packages</span>(</span>
<span id="cb1-2"> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"conflicted"</span>,</span>
<span id="cb1-3">   <span class="st" style="color: #20794D;">"dotenv"</span>,</span>
<span id="cb1-4">   <span class="st" style="color: #20794D;">"targets"</span>,</span>
<span id="cb1-5">   <span class="st" style="color: #20794D;">"tarchetypes"</span>,</span>
<span id="cb1-6">   <span class="st" style="color: #20794D;">"BiocManager"</span>,</span>
<span id="cb1-7">   <span class="st" style="color: #20794D;">"viridis"</span>)</span>
<span id="cb1-8">)</span>
<span id="cb1-9"></span>
<span id="cb1-10">BiocManager<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">install</span>(<span class="st" style="color: #20794D;">"limma"</span>)</span>
<span id="cb1-11"></span>
<span id="cb1-12">remotes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">install_github</span>(</span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"milesmcbain/tflow"</span>,</span>
<span id="cb1-14">    <span class="st" style="color: #20794D;">"moseleyBioinformaticsLab/ICIKendallTau"</span>,</span>
<span id="cb1-15">    <span class="st" style="color: #20794D;">"moseleyBioinformaticsLab/visualizationQualityControl"</span>))</span></code></pre></div>
</section>
<section id="example-analysis" class="level2">
<h2 class="anchored" data-anchor-id="example-analysis">Example Analysis</h2>
<p>The example we will work through is a lipidomics data analysis. This data is based on real data, but sample IDs have been completely anonymized. I’m going to walk through all the steps I do to set up the analysis, mostly by commenting the example <code>_targets.R</code> file, and leaving the objects in the order they were created.</p>
<section id="create-new-project" class="level3">
<h3 class="anchored" data-anchor-id="create-new-project">Create New Project</h3>
<p>We start by creating a brand new RStudio project to work in, or any new directory.</p>
</section>
<section id="initialize-tflow" class="level3">
<h3 class="anchored" data-anchor-id="initialize-tflow">Initialize tflow</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">tflow<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">use_tflow</span>()</span>
<span id="cb2-2">✔ Setting active project to <span class="st" style="color: #20794D;">'/home/rmflight/Projects/personal/example_targets_workflow'</span></span>
<span id="cb2-3">✔ Creating <span class="st" style="color: #20794D;">'R/'</span></span>
<span id="cb2-4">✔ Writing <span class="st" style="color: #20794D;">'packages.R'</span></span>
<span id="cb2-5">✔ Writing <span class="st" style="color: #20794D;">'_targets.R'</span></span>
<span id="cb2-6">✔ Writing <span class="st" style="color: #20794D;">'.env'</span></span></code></pre></div>
<p>In addition to this, I’ve created a <code>data</code> directory, and added the measurements CSV and metadata CSV to that directory.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">dir</span>(<span class="st" style="color: #20794D;">"data"</span>)</span>
<span id="cb3-2">[<span class="dv" style="color: #AD0000;">1</span>] <span class="st" style="color: #20794D;">"sample_measurements.csv"</span> <span class="st" style="color: #20794D;">"sample_metadata.csv"</span></span></code></pre></div>
<p>Some important things about using <code>{tflow}</code> in this project:</p>
<ul>
<li><code>{tflow}</code> uses the <code>targets::tar_plan()</code> function to contain the various targets in the workflow.</li>
<li>This means you don’t have to have a list of targets at the end of <code>_targets.R</code>.</li>
<li>It also means you can use <code>{drake}</code> style targets of the form:</li>
</ul>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"> out_target <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">function_name</span>(in_target),</span>
<span id="cb4-2"> ...</span></code></pre></div>
<p>I personally think it makes the workflow much more readable than the default targets style of:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">tar_target</span>(</span>
<span id="cb5-2">  out_target</span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">function_name</span>(in_target)</span>
<span id="cb5-4">)</span></code></pre></div>
</section>
<section id="setup-packages" class="level3">
<h3 class="anchored" data-anchor-id="setup-packages">Setup Packages</h3>
<p>We modify the <code>packages.R</code> file to add anything else we need.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## library() calls go here</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">library</span>(conflicted)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;">library</span>(dotenv)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">library</span>(targets)</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;">library</span>(tarchetypes)</span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;"># our extra packages for this analysis</span></span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;">library</span>(visualizationQualityControl)</span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;">library</span>(ICIKendallTau)</span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb6-11"><span class="fu" style="color: #4758AB;">library</span>(limma)</span></code></pre></div>
</section>
<section id="initial-_targets.r" class="level3">
<h3 class="anchored" data-anchor-id="initial-_targets.r">Initial _targets.R</h3>
<p>This is what <code>{tflow}</code> sets up to run when you start.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Load your packages, e.g. library(targets).</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;">source</span>(<span class="st" style="color: #20794D;">"./packages.R"</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Load your R files</span></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;">lapply</span>(<span class="fu" style="color: #4758AB;">list.files</span>(<span class="st" style="color: #20794D;">"./R"</span>, <span class="at" style="color: #657422;">full.names =</span> <span class="cn" style="color: #8f5902;">TRUE</span>), source)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="do" style="color: #5E5E5E;
font-style: italic;">## tar_plan supports drake-style targets and also tar_target()</span></span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;">tar_plan</span>(</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;"># target = function_to_make(arg), ## drake style</span></span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;"># tar_target(target2, function_to_make2(arg)) ## targets style</span></span>
<span id="cb7-13"></span>
<span id="cb7-14">)</span></code></pre></div>
<p>Notice that the first thing that happens is that the <code>packages.R</code> file gets sourced, so that all your packages are loaded. Second, it runs through all of the files in <code>R</code>, and sources them to load all the functions. <code>{tflow}</code> and <code>{targets}</code> expound a functional workflow, where we put things in functions. Finally, it uses <code>tar_plan()</code> to run each of the targets.</p>
<p>We will specify each of the targets in turn to fill out the analysis we want to do.</p>
</section>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<p>Lets first <strong>declare</strong> the measurement file and metadata file as actual targets, so if they change, then any dependent targets will be re-run as well.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">tar_plan</span>(</span>
<span id="cb8-2"></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">tar_target</span>(measurement_file,</span>
<span id="cb8-4">             <span class="st" style="color: #20794D;">"data/sample_measurements.csv"</span>,</span>
<span id="cb8-5">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>),</span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">tar_target</span>(metadata_file,</span>
<span id="cb8-7">             <span class="st" style="color: #20794D;">"data/sample_metadata.csv"</span>,</span>
<span id="cb8-8">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10">)</span></code></pre></div>
<p>Running it with <code>tar_make()</code> results in:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb9-2">• start target measurement_file</span>
<span id="cb9-3">• built target measurement_file [<span class="fl" style="color: #AD0000;">0.001</span> seconds]</span>
<span id="cb9-4">• start target metadata_file</span>
<span id="cb9-5">• built target metadata_file [<span class="fl" style="color: #AD0000;">0.001</span> seconds]</span>
<span id="cb9-6">• end pipeline [<span class="fl" style="color: #AD0000;">0.078</span> seconds]</span></code></pre></div>
<p>Then we add in actually reading in the data.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;">tar_plan</span>(</span>
<span id="cb10-2"></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">tar_target</span>(measurement_file,</span>
<span id="cb10-4">             <span class="st" style="color: #20794D;">"data/sample_measurements.csv"</span>,</span>
<span id="cb10-5">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>),</span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">tar_target</span>(metadata_file,</span>
<span id="cb10-7">             <span class="st" style="color: #20794D;">"data/sample_metadata.csv"</span>,</span>
<span id="cb10-8">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>)</span>
<span id="cb10-9"></span>
<span id="cb10-10">  <span class="at" style="color: #657422;">lipid_measurements =</span> readr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">read_csv</span>(measurement_file),</span>
<span id="cb10-11">  <span class="at" style="color: #657422;">lipid_metadata =</span> readr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">read_csv</span>(metadata_file),</span>
<span id="cb10-12"></span>
<span id="cb10-13">)</span></code></pre></div>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb11-2">✔ skip target measurement_file</span>
<span id="cb11-3">✔ skip target metadata_file</span>
<span id="cb11-4">• start target lipid_measurements</span>
<span id="cb11-5">Rows<span class="sc" style="color: #5E5E5E;">:</span> <span class="dv" style="color: #AD0000;">1012</span> Columns<span class="sc" style="color: #5E5E5E;">:</span> <span class="dv" style="color: #AD0000;">16</span></span>
<span id="cb11-6">── Column specification ────────────────────────────────────────────────────────</span>
<span id="cb11-7">Delimiter<span class="sc" style="color: #5E5E5E;">:</span> <span class="st" style="color: #20794D;">","</span></span>
<span id="cb11-8"><span class="fu" style="color: #4758AB;">chr</span>  (<span class="dv" style="color: #AD0000;">4</span>)<span class="sc" style="color: #5E5E5E;">:</span> class, name, group_units, feature_id</span>
<span id="cb11-9"><span class="fu" style="color: #4758AB;">dbl</span> (<span class="dv" style="color: #AD0000;">12</span>)<span class="sc" style="color: #5E5E5E;">:</span> WT_1, WT_2, WT_3, WT_4, WT_5, WT_6, KO_1, KO_2, KO_3, KO_4, KO_5, ...</span>
<span id="cb11-10"><span class="sc" style="color: #5E5E5E;">|</span></span>
<span id="cb11-11">ℹ Use <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">spec()</span><span class="st" style="color: #20794D;">`</span> to retrieve the full column specification <span class="cf" style="color: #003B4F;">for</span> this data.</span>
<span id="cb11-12">ℹ Specify the column types or set <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">show_col_types = FALSE</span><span class="st" style="color: #20794D;">`</span> to quiet this message.</span>
<span id="cb11-13">• built target lipid_measurements [<span class="fl" style="color: #AD0000;">0.305</span> seconds]</span>
<span id="cb11-14">• start target lipid_metadata</span>
<span id="cb11-15">Rows<span class="sc" style="color: #5E5E5E;">:</span> <span class="dv" style="color: #AD0000;">12</span> Columns<span class="sc" style="color: #5E5E5E;">:</span> <span class="dv" style="color: #AD0000;">18</span></span>
<span id="cb11-16">── Column specification ────────────────────────────────────────────────────────</span>
<span id="cb11-17">Delimiter<span class="sc" style="color: #5E5E5E;">:</span> <span class="st" style="color: #20794D;">","</span></span>
<span id="cb11-18"><span class="fu" style="color: #4758AB;">chr</span> (<span class="dv" style="color: #AD0000;">10</span>)<span class="sc" style="color: #5E5E5E;">:</span> parent_sample_name, assay, cell_line, client_matrix, client_sample...</span>
<span id="cb11-19"><span class="fu" style="color: #4758AB;">dbl</span>  (<span class="dv" style="color: #AD0000;">8</span>)<span class="sc" style="color: #5E5E5E;">:</span> client_identifier, client_sample_number, group_number, sample_amou...</span>
<span id="cb11-20"><span class="sc" style="color: #5E5E5E;">/</span></span>
<span id="cb11-21">ℹ Use <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">spec()</span><span class="st" style="color: #20794D;">`</span> to retrieve the full column specification <span class="cf" style="color: #003B4F;">for</span> this data.</span>
<span id="cb11-22">ℹ Specify the column types or set <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">show_col_types = FALSE</span><span class="st" style="color: #20794D;">`</span> to quiet this message.</span>
<span id="cb11-23">• built target lipid_metadata [<span class="fl" style="color: #AD0000;">0.07</span> seconds]</span>
<span id="cb11-24">• end pipeline [<span class="fl" style="color: #AD0000;">0.47</span> seconds]</span></code></pre></div>
</section>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h3>
<p>For the exploratory data analysis (EDA), I like to put that into a report. You set those up using <code>tflow::use_rmd("document_name")</code> or <code>tflow::use_qmd("document_name)</code>. An example <a href="https://github.com/rmflight/example_targets_workflow/blob/main/doc/exploration.Rmd">EDA report</a> is available at the actual repo.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">tflow<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">use_rmd</span>(<span class="st" style="color: #20794D;">"exploration"</span>)</span>
<span id="cb12-2">✔ Setting active project to <span class="st" style="color: #20794D;">'/home/rmflight/Projects/personal/example_targets_workflow'</span></span>
<span id="cb12-3">✔ Writing <span class="st" style="color: #20794D;">'doc/exploration.Rmd'</span></span>
<span id="cb12-4">Add this target to your <span class="fu" style="color: #4758AB;">tar_plan</span>()<span class="sc" style="color: #5E5E5E;">:</span></span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;">tar_render</span>(exploration, <span class="st" style="color: #20794D;">"doc/exploration.Rmd"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;">tar_plan</span>(</span>
<span id="cb13-2"></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">tar_target</span>(measurement_file,</span>
<span id="cb13-4">             <span class="st" style="color: #20794D;">"data/sample_measurements.csv"</span>,</span>
<span id="cb13-5">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>),</span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;">tar_target</span>(metadata_file,</span>
<span id="cb13-7">             <span class="st" style="color: #20794D;">"data/sample_metadata.csv"</span>,</span>
<span id="cb13-8">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>)</span>
<span id="cb13-9"></span>
<span id="cb13-10">  <span class="at" style="color: #657422;">lipid_measurements =</span> readr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">read_csv</span>(measurement_file),</span>
<span id="cb13-11">  <span class="at" style="color: #657422;">lipid_metadata =</span> readr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">read_csv</span>(metadata_file),</span>
<span id="cb13-12">  </span>
<span id="cb13-13">  <span class="fu" style="color: #4758AB;">tar_render</span>(exploration, <span class="st" style="color: #20794D;">"doc/exploration.Rmd"</span>)</span>
<span id="cb13-14">)</span></code></pre></div>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="sc" style="color: #5E5E5E;">&gt;</span> targets<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb14-2">✔ skip target measurement_file</span>
<span id="cb14-3">✔ skip target metadata_file</span>
<span id="cb14-4">✔ skip target lipid_measurements</span>
<span id="cb14-5">✔ skip target lipid_metadata</span>
<span id="cb14-6">• start target exploration</span>
<span id="cb14-7">• built target exploration [<span class="fl" style="color: #AD0000;">2.829</span> seconds]</span>
<span id="cb14-8">• end pipeline [<span class="fl" style="color: #AD0000;">2.922</span> seconds]</span></code></pre></div>
<p>Note we could have put these bits in their own functions instead of keeping them in the document proper:</p>
<ul>
<li>ICI-Kt correlations;</li>
<li>Heatmap figure;</li>
<li>PCA decomposition;</li>
<li>PCA visualization</li>
</ul>
<p>These are left as an exercise for the reader.</p>
</section>
<section id="differential-analysis" class="level3">
<h3 class="anchored" data-anchor-id="differential-analysis">Differential Analysis</h3>
<p>Following EDA, we need to do the differential analysis. But for that, we need to do normalization and imputation of missing values first. Each one of those should be their own functions. <a href="https://github.com/rmflight/example_targets_workflow/blob/main/R/differential.R#L1">Here</a> is the normalization function, <a href="https://github.com/rmflight/example_targets_workflow/blob/main/R/differential.R#L26">here</a> is the imputation, and <a href="https://github.com/rmflight/example_targets_workflow/blob/main/R/differential.R#L41">here</a> is the differential analysis function.</p>
<p>And here is the output of running each step.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;"># normalization</span></span>
<span id="cb15-2"><span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb15-3">✔ skip target measurement_file</span>
<span id="cb15-4">✔ skip target metadata_file</span>
<span id="cb15-5">✔ skip target lipid_measurements</span>
<span id="cb15-6">✔ skip target lipid_metadata</span>
<span id="cb15-7">• start target lipid_normalized</span>
<span id="cb15-8">New names<span class="sc" style="color: #5E5E5E;">:</span></span>
<span id="cb15-9">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...1</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-10">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...2</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-11">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...3</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-12">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...4</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-13">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...5</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-14">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...6</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-15">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...7</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-16">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...8</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-17">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...9</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-18">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...10</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-19">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...11</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-20">• <span class="st" style="color: #20794D;">``</span> <span class="ot" style="color: #003B4F;">-&gt;</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">...12</span><span class="st" style="color: #20794D;">`</span></span>
<span id="cb15-21">• built target lipid_normalized [<span class="fl" style="color: #AD0000;">0.449</span> seconds]</span>
<span id="cb15-22">✔ skip target exploration</span>
<span id="cb15-23">• end pipeline [<span class="fl" style="color: #AD0000;">0.562</span> seconds]</span></code></pre></div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;"># imputing missing values</span></span>
<span id="cb16-2"><span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb16-3">✔ skip target measurement_file</span>
<span id="cb16-4">✔ skip target metadata_file</span>
<span id="cb16-5">✔ skip target lipid_measurements</span>
<span id="cb16-6">✔ skip target lipid_metadata</span>
<span id="cb16-7">✔ skip target lipid_normalized</span>
<span id="cb16-8">✔ skip target exploration</span>
<span id="cb16-9">• start target lipid_imputed</span>
<span id="cb16-10">• built target lipid_imputed [<span class="fl" style="color: #AD0000;">0.05</span> seconds]</span>
<span id="cb16-11">• end pipeline [<span class="fl" style="color: #AD0000;">0.169</span> seconds]</span></code></pre></div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;"># differential analysis</span></span>
<span id="cb17-2"><span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb17-3">✔ skip target measurement_file</span>
<span id="cb17-4">✔ skip target metadata_file</span>
<span id="cb17-5">✔ skip target lipid_measurements</span>
<span id="cb17-6">✔ skip target lipid_metadata</span>
<span id="cb17-7">✔ skip target lipid_normalized</span>
<span id="cb17-8">✔ skip target exploration</span>
<span id="cb17-9">✔ skip target lipid_imputed</span>
<span id="cb17-10">• start target lipids_differential</span>
<span id="cb17-11">• built target lipids_differential [<span class="fl" style="color: #AD0000;">0.198</span> seconds]</span>
<span id="cb17-12">• end pipeline [<span class="fl" style="color: #AD0000;">0.312</span> seconds]</span></code></pre></div>
<p>I <strong>try</strong> to build it up piecewise like this because it lets me easily load the previous target into the next function. Most of my functions will have <code>tar_load(previous_target)</code> at the top as a comment, or <code>varname = tar_read(previous_target)</code>, if I’ve got a more generic variable name I want to use that doesn’t match the name of the target coming into the function. For example, here is the top of the normalization function.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">normalize_samples <span class="ot" style="color: #003B4F;">=</span> <span class="cf" style="color: #003B4F;">function</span>(lipid_measurements){</span>
<span id="cb18-2">  <span class="co" style="color: #5E5E5E;"># do normalization in here and return the df</span></span>
<span id="cb18-3">  <span class="co" style="color: #5E5E5E;"># tar_load(lipid_measurements)</span></span>
<span id="cb18-4">...</span></code></pre></div>
<p>This strategy lets me easily load the variables I need in that function space and develop the actual code of the function. I will very often couple this with restarting the R session, <code>source("./packages.R")</code>, and if needed <code>lapply(...)</code> sourcing the R function files, and then load the necessary variables and start writing the code for the function.</p>
</section>
<section id="final-report" class="level3">
<h3 class="anchored" data-anchor-id="final-report">Final Report</h3>
<p>Finally, we can put the differential results in our final report. So that they are together, we can make the EDA report a <strong>child document</strong> of the differential report, and include it as well. Let’s actually make a copy, and include it as a child document.</p>
<p>We add it to the plan as another target using the <code>tar_target</code> syntax, because as far as I know that is the only way to include something as a file dependency. If we want the <strong>differential_report</strong> target to get rerun when the <em>exploration</em> one is changed, this is the way to do it, have a target in the <code>tar_plan</code>, and then make sure to load the target in the <em>differential_report</em> itself.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;"># on the command line / terminal / console</span></span>
<span id="cb19-2"><span class="sc" style="color: #5E5E5E;">&gt;</span>tflow<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">use_rmd</span>(<span class="st" style="color: #20794D;">"differential_report"</span>)</span>
<span id="cb19-3">✔ Writing <span class="st" style="color: #20794D;">'doc/differential_report.Rmd'</span></span>
<span id="cb19-4">Add this target to your <span class="fu" style="color: #4758AB;">tar_plan</span>()<span class="sc" style="color: #5E5E5E;">:</span></span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="fu" style="color: #4758AB;">tar_render</span>(differential_report2, <span class="st" style="color: #20794D;">"doc/differential_report.Rmd"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;"># in the _targets.R file</span></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;"># add the child target</span></span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;">tar_target</span>(exploration_child,</span>
<span id="cb20-4">             <span class="st" style="color: #20794D;">"doc/exploration_child.Rmd"</span>,</span>
<span id="cb20-5">             <span class="at" style="color: #657422;">format =</span> <span class="st" style="color: #20794D;">"file"</span>),</span>
<span id="cb20-6">             </span>
<span id="cb20-7"><span class="co" style="color: #5E5E5E;"># and then generate final report</span></span>
<span id="cb20-8"><span class="fu" style="color: #4758AB;">tar_render</span>(differential_report, <span class="st" style="color: #20794D;">"doc/differential_report.Rmd"</span>)</span></code></pre></div>
<p>In the rmarkdown:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><span class="in" style="color: #5E5E5E;">```{r eda child='doc/exploration_child.Rmd'}</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;">plot</span>(cars)</span>
<span id="cb21-3"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;"># run the differential report</span></span>
<span id="cb22-2"><span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="fu" style="color: #4758AB;">tar_make</span>()</span>
<span id="cb22-3">✔ skip target measurement_file</span>
<span id="cb22-4">✔ skip target metadata_file</span>
<span id="cb22-5">✔ skip target exploration_child</span>
<span id="cb22-6">✔ skip target lipid_measurements</span>
<span id="cb22-7">✔ skip target lipid_metadata</span>
<span id="cb22-8">✔ skip target lipid_normalized</span>
<span id="cb22-9">✔ skip target exploration</span>
<span id="cb22-10">✔ skip target lipid_imputed</span>
<span id="cb22-11">✔ skip target lipids_differential</span>
<span id="cb22-12">• start target differential_report</span>
<span id="cb22-13">• built target differential_report [<span class="fl" style="color: #AD0000;">3.018</span> seconds]</span>
<span id="cb22-14">• end pipeline [<span class="fl" style="color: #AD0000;">3.14</span> seconds]</span></code></pre></div>
</section>
</section>
<section id="notes-about-rmarkdown-and-quarto" class="level2">
<h2 class="anchored" data-anchor-id="notes-about-rmarkdown-and-quarto">Notes About Rmarkdown and Quarto</h2>
<p>If you want to be able to interactively mess with your Rmarkdown / Quarto docs while under <code>{targets}</code>, then you need to change the setting <strong>Chunk Output Inline</strong> to <strong>Chunk Output in Console</strong>.</p>
<p>If you want to run a full render of the document <strong>outside</strong> of the <code>{targets}</code> workflow, then you have to add an option to the <strong>interactive</strong> (shell, console) calls to <code>{rmarkdown}</code> and <code>{quarto}</code> to either use the <code>knit_root_dir</code> or <code>execute_dir</code> arguments, respectively. Both of those should be in the top level directory of the <code>{targets}</code> project, which most often at the console can be gotten by using <code>getwd()</code>, as shown in the examples below.</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;"># for rmarkdown</span></span>
<span id="cb23-2">rmarkdown<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">render</span>(<span class="st" style="color: #20794D;">"doc/document.Rmd"</span>, <span class="at" style="color: #657422;">knit_root_dir =</span> <span class="fu" style="color: #4758AB;">getwd</span>())</span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;"># for quarto</span></span>
<span id="cb23-4">quarto<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">quarto_render</span>(<span class="st" style="color: #20794D;">"doc/document.qmd"</span>, <span class="at" style="color: #657422;">execute_dir =</span> <span class="fu" style="color: #4758AB;">getwd</span>())</span></code></pre></div>
<p>There is also currently an issue with using <code>{gt}</code> tables in Quarto -&gt; Word documents within <code>{targets}</code> workflows that as of 2022-09-27, is not quite resolved.</p>
<p><em>Edited 2022-11-30:</em> Added a couple of notes on the use of <code>{tflow}</code> and subsequently <code>tar_plan()</code></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Creating an {Analysis} {With} a Targets {Workflow}},
  date = {2022-09-27},
  url = {https://rmflight.github.io/posts/2022-09-27-creating-an-analysis-using-targets},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Creating an Analysis With a Targets
Workflow.”</span> September 27, 2022. <a href="https://rmflight.github.io/posts/2022-09-27-creating-an-analysis-using-targets">https://rmflight.github.io/posts/2022-09-27-creating-an-analysis-using-targets</a>.
</div></div></section></div> ]]></description>
  <category>analysis</category>
  <category>development</category>
  <category>mass-spectrometry</category>
  <category>targets</category>
  <guid>https://rmflight.github.io/posts/2022-09-27-creating-an-analysis-using-targets/index.html</guid>
  <pubDate>Tue, 27 Sep 2022 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Compiling Against Python.h</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-06-22-compiling-against-pythonh/index.html</link>
  <description><![CDATA[ 




<p>Sometimes, the installed version of Python on your linux system isn’t what you need, and you can’t easily install a newer version system-wide. Of course, you can download, extract, and configure and then make Python that lives in it’s own directory. But then you don’t have all the pointers to the <code>Include</code> directories that are useful for linking stuff against. And you don’t want to change symlinks at the system level, that might break things, a lot of things.</p>
<p>If you are using <code>cython</code> to speed up your code, then it needs to know where exactly to find those extra header files. Unfortunately, it needs both the C++ and the C versions, it seems.</p>
<p>Lets go through the steps of setting up a new python, and then linking it for compiling cythonized programs.</p>
<section id="download-and-make" class="level2">
<h2 class="anchored" data-anchor-id="download-and-make">Download and Make</h2>
<p>Download <a href="https://www.python.org/downloads/">python</a>, and navigate to where you saved it. I’ll assume we downloaded version 10 to <code>~/software</code></p>
<pre><code>cd ~/software
tar -xzf Python-3.10.5.tgz
cd Python-3.10.5
./configure --enable-optimizations
make</code></pre>
</section>
<section id="setup-new-virtualenv-with-it" class="level2">
<h2 class="anchored" data-anchor-id="setup-new-virtualenv-with-it">Setup New Virtualenv With It</h2>
<p>Make sure you have <code>virtualenv</code> installed, its necessary if you want to specify a specific version of python. Yes, you could probably get around this with <code>conda</code> or <code>docker</code>, but we are doing things the painful way.</p>
<pre><code>virtualenv -p ~/software/Python-3.10.5/python ~/py10_venv
source ~/py10_venv/activate</code></pre>
</section>
<section id="add-it-to-environment" class="level2">
<h2 class="anchored" data-anchor-id="add-it-to-environment">Add It to Environment</h2>
<pre><code>export C_INCLUDE_PATH=/home/rmflight/software/Python-3.10.5:$C_INCLUDE_PATH</code></pre>
</section>
<section id="install-something-cython" class="level2">
<h2 class="anchored" data-anchor-id="install-something-cython">Install Something Cython</h2>
<p>We are going to install a package that needs only a <em>few</em> python deps, our labs <code>icikt</code> package.</p>
<pre><code># check that you are using the right version in the venv
python3 --version
python3 -m pip install docopt
python3 -m pip install scipy
python3 -m pip install cython</code></pre>
<pre><code>cd ~/software
git clone git@github.com:MoseleyBioinformaticsLab/icikt.git</code></pre>
<pre><code>python3 -m pip install --global-option=build_ext --global-option="-I/home/rmflight/software/Python-3.10.5/Include" ~/software/icikt</code></pre>
<p>Notice we’ve done two very important things overall:</p>
<ol type="1">
<li>Added a path, <code>C_INCLUDE_PATH</code></li>
<li>Added two <code>--global-option</code> in the call to build our local package</li>
</ol>
<p>For some reason we need <strong>both</strong> the environment variable path, and the global option to get this to work.</p>
<p>If you forget one or the other, you will see error messages concerning python.h</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Compiling {Against} {Python.h}},
  date = {2022-06-22},
  url = {https://rmflight.github.io/posts/2022-06-22-compiling-against-pythonh},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Compiling Against Python.h.”</span> June
22, 2022. <a href="https://rmflight.github.io/posts/2022-06-22-compiling-against-pythonh">https://rmflight.github.io/posts/2022-06-22-compiling-against-pythonh</a>.
</div></div></section></div> ]]></description>
  <category>python</category>
  <category>cython</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2022-06-22-compiling-against-pythonh/index.html</guid>
  <pubDate>Wed, 22 Jun 2022 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Project Consultation Template</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-02-08-project-consultation-template/index.html</link>
  <description><![CDATA[ 




<section id="motivating-tweet" class="level2">
<h2 class="anchored" data-anchor-id="motivating-tweet">Motivating Tweet</h2>
<p>A little while ago, I was tweeting about the joy of collaborating with people who haven’t included you in their experimental design. One of the <a href="https://twitter.com/rmflight/status/1490155702438219777?s=20&amp;t=W4cx7JY3qDHEaJUpKjehyw">tweets</a> was this:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2022-02-08-project-consultation-template/tweet_about_projects.png" class="img-fluid" style="width:80.0%"></p>
</div>
</div>
<p>I decided that I should follow up with our actual project consultation template.</p>
</section>
<section id="consultations" class="level2">
<h2 class="anchored" data-anchor-id="consultations">Consultations?</h2>
<p>A large part of my work is collaborative projects where I do various -omics analyses for members of the cancer center I’m part of. As I’m sure many of you know, it’s very important for us to capture the details of the experiments so we can figure out what actually needs to be done, and the most appropriate method.</p>
<p>Internally, we use a self-hosted foswiki instance to keep lists of what needs to be done, document SOPs, and capture experimental details from collaborators.</p>
<p>With every project we get asked to work on, we have a meeting, and who is at that meeting is usually determined by what kind of analysis the potential collaborator has asked for.</p>
</section>
<section id="template" class="level2">
<h2 class="anchored" data-anchor-id="template">Template</h2>
<p>During that meeting, we fill in all the details of this template (which I translated to markdown from foswiki). Obviously, not all of the fields necessarily get filled out for each project, and sometimes other custom fields will get added. This template helps us capture the minimum information needed.</p>
<pre><code>## Meeting Description
  * Date/Time: 
  * Length: 1 hour

### Attendance
  * 
  * 

### Meeting Purpose

## Project Description

### Overall Purpose

### Implementation Timeline
  * Design/Conceptualization:
  * Experiment: 
    * Start:  ; End:
  * Sample Collection and Preparation:
  * Data Collection:
  * Data Analysis:

### Experimental Design

### Specific Data Analysis Questions

## Conclusions

### TODO
</code></pre>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Project {Consultation} {Template}},
  date = {2022-02-08},
  url = {https://rmflight.github.io/posts/2022-02-08-project-consultation-template},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Project Consultation Template.”</span>
February 8, 2022. <a href="https://rmflight.github.io/posts/2022-02-08-project-consultation-template">https://rmflight.github.io/posts/2022-02-08-project-consultation-template</a>.
</div></div></section></div> ]]></description>
  <category>research</category>
  <guid>https://rmflight.github.io/posts/2022-02-08-project-consultation-template/index.html</guid>
  <pubDate>Tue, 08 Feb 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Heatmap Colormaps!</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-01-31-heatmap-colormaps/index.html</link>
  <description><![CDATA[ 




<section id="normal-incrementing-data" class="level2">
<h2 class="anchored" data-anchor-id="normal-incrementing-data">Normal Incrementing Data</h2>
<p>Nine times out of ten, you probably need just one of the <code>{viridis}</code> colormaps for values that are increasing in one direction. For example, correlation values that are all positive, or abundances from RNA-Seq, etc. If you want to use them with <code>{ComplexHeatmap}</code>, you do so like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># correlation example for 0 - 1</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;"># imagine cor_vals is a set of correlation values</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(ComplexHeatmap)</span>
<span id="cb1-4">cor_start <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb1-5">cor_end <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb1-6">n_break <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">20</span></span>
<span id="cb1-7">viridis_map <span class="ot" style="color: #003B4F;">=</span> circlize<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">colorRamp2</span>(<span class="fu" style="color: #4758AB;">seq</span>(cor_start, </span>
<span id="cb1-8">                                       cor_end, </span>
<span id="cb1-9">                                       <span class="at" style="color: #657422;">length.out =</span> n_break),</span>
<span id="cb1-10">                                   viridis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">viridis</span>(n_break))</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;">Heatmap</span>(cor_vals, </span>
<span id="cb1-13">        <span class="at" style="color: #657422;">col =</span> viridis_map, </span>
<span id="cb1-14">        ...)</span></code></pre></div>
</div>
</section>
<section id="divergent-data" class="level2">
<h2 class="anchored" data-anchor-id="divergent-data">Divergent Data</h2>
<p>In this case, you have values where a <strong>central</strong> value is a natural point that you want to highlight things <strong>above</strong> and <strong>below</strong> that value. Examples include correlations that include negative and positive correlations, log-fold-changes above and below zero. In this case, I prefer the <code>{scico}</code> package with the <code>vik</code> colormap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">cor_start <span class="ot" style="color: #003B4F;">=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb2-2">cor_end <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb2-3">n_break <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">20</span></span>
<span id="cb2-4"></span>
<span id="cb2-5">scico_map <span class="ot" style="color: #003B4F;">=</span> circlize<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">colorRamp2</span>(<span class="fu" style="color: #4758AB;">seq</span>(cor_start</span>
<span id="cb2-6">                                     cor_end,</span>
<span id="cb2-7">                                     <span class="at" style="color: #657422;">length.out =</span> n_break),</span>
<span id="cb2-8">                                 scico<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scico</span>(n_break, </span>
<span id="cb2-9">                                              <span class="at" style="color: #657422;">palette =</span> <span class="st" style="color: #20794D;">"vik"</span>))</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;">Heatmap</span>(cor_vals, </span>
<span id="cb2-12">        <span class="at" style="color: #657422;">col =</span> scico_map,</span>
<span id="cb2-13">        ...)</span></code></pre></div>
</div>
</section>
<section id="other-colormaps" class="level2">
<h2 class="anchored" data-anchor-id="other-colormaps">Other Colormaps?</h2>
<p>Do you have other suggestions for colormaps, both incremental and divergent? Please let me know in the comments!</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Heatmap {Colormaps!}},
  date = {2022-01-31},
  url = {https://rmflight.github.io/posts/2022-01-31-heatmap-colormaps},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Heatmap Colormaps!”</span> January 31,
2022. <a href="https://rmflight.github.io/posts/2022-01-31-heatmap-colormaps">https://rmflight.github.io/posts/2022-01-31-heatmap-colormaps</a>.
</div></div></section></div> ]]></description>
  <category>colormaps</category>
  <category>visualization</category>
  <category>heatmap</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2022-01-31-heatmap-colormaps/index.html</guid>
  <pubDate>Mon, 31 Jan 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Recreating Correlation Values from Another Manuscript</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/index.html</link>
  <description><![CDATA[ 




<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>I’ve been working on a manuscript for our newish correlation method, information-content-informed Kendall-tau (ICI-Kendalltau, package currently at <span class="citation" data-cites="icikendalltau">(Flight and Moseley 2021)</span>). As part of that manuscript, we wanted to highlight how well the correlation measure detects outlier samples. Two datasets we are using for that aspect are public, one from The Cancer Genome Atlas and the other from the Barton group. The Barton group and collaborators produced a highly replicated RNAseq yeast dataset, 48 replicates in two conditions, and have used it in various analyses <span class="citation" data-cites="Gierlinski2015 Schurch2016">(Gierliński et al. 2015; Schurch et al. 2016)</span>.</p>
</section>
<section id="so-what" class="level2">
<h2 class="anchored" data-anchor-id="so-what">So What</h2>
<p>For my manuscript, ideally I want to be able to comment on the outliers found in one of the Barton group manuscripts <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span>. To do that, I need access to one of:</p>
<ul>
<li>the sample-sample correlations themselves,</li>
<li>the counts from each sample</li>
<li>or be able to recreate counts from each sample.</li>
</ul>
<p>Several years ago I was asking about this dataset on twitter when I was using it for another project, because the project ID in the SRA didn’t have a mapping to condition. Dr.&nbsp;Geoff Barton pointed me to a metadata file available on figshare <span class="citation" data-cites="Barton2015">(Barton, Blaxter, Cole, Gharbi, Gierliński, Owen-Hughes, et al. 2015)</span>. This allowed me to generate read counts across biological replicates (which is what I was interested in at the time). However, if I had poked around the figshare project a bit more, I would have likely seen both of the files with read counts for each replicate already available <span class="citation" data-cites="SNF2Barton2015 WTBarton2015">(Barton, Blaxter, Cole, Gharbi, Gierliński, Schofield, et al. 2015a, 2015b)</span>. It really sucks that I hadn’t noticed these other files years ago, it would have saved me the effort in remapping and generating gene counts myself, as well as getting really weird correlation values compared to <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span>.</p>
</section>
<section id="my-correlations" class="level2">
<h2 class="anchored" data-anchor-id="my-correlations">My Correlations</h2>
<p>From the demultiplexed read data and the metadata file I found several years ago, I had run RNA-seq mapping software to generate read counts for each sample in each lane, and summed them across lanes. I know how to do these kinds of things, even though I will be the first to admit it is <strong>not</strong> my personal bread and butter analysis (I normally get involved after count generation). With the (few) hints from the manuscript about how <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span> did the correlation calculation (see more below), I don’t get anything close to the range of median correlation values within each class of samples. Which I thought was very, very weird. I implemented a variety of transformation methods and inclusion of missing values for my correlation calculations:</p>
<ul>
<li>logged values (log and log1p)</li>
<li>raw values</li>
<li>removal and inclusion of missing (0) values</li>
</ul>
<p>Even with all of these variations, I could not come close to the same values I found presented in their manuscript. Here, in panel (a) of Figure 2 from <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span>, the median correlations range from 0.7 to 1.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/gierlinski_2015_fig2_cropped.png" class="external img-fluid figure-img" width="950"></p>
<p></p><figcaption class="figure-caption">Figure 2(a) from <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span>. Identifying bad RNA-seq replicates in the WT (left) and Δsnf2 (right) data. The top three panels (a–c) show individual criteria for identifying ‘bad’ replicates which are combined into a quality score (d) in order to identify ‘bad’ replicates in each condition. The identified ‘bad’ replicates are shown as numbered points in each panel. The individual criteria are (a) median correlation coefficient, ri∼⁠, for each replicate i against all other replicates, (b) outlier fraction, fi⁠, calculated as a fraction of genes where the given replicate is more than five-trimmed standard deviations from the trimmed mean and (c) median reduced χ2 of pileup depth, χ∼2i⁠, as a measure of the non-uniformity of read distribution within genes (see also Fig. 3)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>My ranges, however, were much different.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-2">out_ranges <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">readRDS</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data_files"</span>, <span class="st" style="color: #20794D;">"ranges.rds"</span>))</span>
<span id="cb1-3">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(out_ranges<span class="sc" style="color: #5E5E5E;">$</span>rmf_ranges, <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">'RMF median correlation ranges. Which is "which" method was used to calculate the correlations.'</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>RMF median correlation ranges. Which is “which” method was used to calculate the correlations.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">which</th>
<th style="text-align: left;">sample_class</th>
<th style="text-align: right;">high</th>
<th style="text-align: right;">low</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">log</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">log</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">0.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log_no0</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">log_no0</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">raw</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">raw</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">0.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">raw_no0</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">raw_no0</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">0.67</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can see in this table, that my median correlation ranges are not even close to what we can see in the figure.</p>
<p>And the lowest values and samples didn’t seem to be right either.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">out_ranges<span class="sc" style="color: #5E5E5E;">$</span>rmf_medians <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(which <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="st" style="color: #20794D;">"raw_no0"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-3">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">group_by</span>(sample_class) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-4">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">arrange</span>(med_cor) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-5">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">6</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-6">  knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(., <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Lowest median correlation values using my own counts."</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Lowest median correlation values using my own counts.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">sample_id</th>
<th style="text-align: right;">med_cor</th>
<th style="text-align: left;">sample_class</th>
<th style="text-align: left;">which</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SNF2.7</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">SNF2.33</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SNF2.27</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">SNF2.8</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SNF2.48</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">SNF2.23</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: left;">SNF2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.32</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.14</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.11</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.13</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.16</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.12</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="finding-the-data" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-data">Finding the Data</h2>
<p>Finally, during the week of 2021-11-25, I happened across another manuscript on this dataset from 2016 <span class="citation" data-cites="Schurch2016">(Schurch et al. 2016)</span>, that mentions a GitHub repo that lo and behold had copies of the preprocessed data to the level of gene counts per biological replicate <span class="citation" data-cites="bartongithub2015">(Cole et al. 2015)</span>. Awesome!</p>
</section>
<section id="new-correlation" class="level2">
<h2 class="anchored" data-anchor-id="new-correlation">New Correlation</h2>
<p>Using that preprocessed data, I was finally able to get what amounted to identical values of correlation, based on comparing the lowest correlation values with the figure. Great.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(out_ranges<span class="sc" style="color: #5E5E5E;">$</span>barton, <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">'Barton median correlation ranges. Which is "which" method was used to calculate the correlations.'</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Barton median correlation ranges. Which is “which” method was used to calculate the correlations.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">which</th>
<th style="text-align: left;">sample_class</th>
<th style="text-align: right;">high</th>
<th style="text-align: right;">low</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">log</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">log</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.97</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log_no0</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.91</td>
</tr>
<tr class="even">
<td style="text-align: left;">log_no0</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">raw</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">raw</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: left;">raw_no0</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">raw_no0</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.77</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In this table, for the <strong>raw</strong> correlations, we finally see median correlation ranges that match what is observed in the figure, especially at the low end. Importantly, the Snf2 lowest value is lower than the WT lowest value. So I’m pretty sure I’m getting the correct sample-sample correlations now.</p>
<p>As well, if I look at the lowest sample - sample correlations in each class, the sample IDs match what is in the figure as well, and so do the median sample-sample correlations for those samples!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">out_ranges<span class="sc" style="color: #5E5E5E;">$</span>barton_medians <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(which <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="st" style="color: #20794D;">"raw_no0"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-3">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">group_by</span>(sample_class) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-4">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">arrange</span>(med_cor) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-5">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">6</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-6">  knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(., <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Lowest median correlation values using Barton counts."</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Lowest median correlation values using Barton counts.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">sample_id</th>
<th style="text-align: right;">med_cor</th>
<th style="text-align: left;">sample_class</th>
<th style="text-align: left;">which</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Snf2.06</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Snf2.13</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Snf2.35</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Snf2.10</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Snf2.25</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Snf2.24</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">Snf2</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.21</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.25</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.28</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.22</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT.17</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT.36</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">raw_no0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="why-no-log-transformation" class="level2">
<h2 class="anchored" data-anchor-id="why-no-log-transformation">Why No Log-Transformation?</h2>
<p>One interesting thing about having the correct correlations is discovering that Gierlinski et al didn’t use log-transformed data in their Pearson correlation calculations. This seems unusual to me. All my career in -omics, the one thing I’ve had drilled into me is that doing a linear correlation on data that has proportional error component or variance is a <strong>very bad</strong> idea. Proportional error or variance means the variance increases with increasing mean values, which is definitely true of these count data.</p>
<p>If I had to guess <strong>why</strong> log-transformed values weren’t used, I think it is because of the analysis in the replicate paper about how well the un-transformed values fit a normal distribution vs a log-normal distribution. That figure and caption are provided here for reference.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/gierlinski_2015_fig5.jpeg" class="external img-fluid figure-img" width="950"></p>
<p></p><figcaption class="figure-caption">Figure 5 from <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span>. Goodness-of-fit test results for normal (top panels), log-normal (middle panels) and negative binomial (bottom panels) distributions. Each panel shows the test P-value versus the mean count across replicates. Each dot represents equal-count normalized data from one gene. Panels on the left (a, b, e, f, i, j) show clean data with bad replicates rejected (42 and 44 replicates remaining in WT and Δsnf2, respectively). Panels on the right (c, d, g, h, k, l) show all available data (48 replicates in each condition). Due to the number of bootstraps performed, P-values for the negative-binomial test are limited to ∼10−2. Due to numerical precision of the software library used, P-values from the normal and log-normal tests are limited to ∼10−16. Below these limits data points are marked in orange (light gray in black and white) at the bottom of each panel. Horizontal lines show the Benjamini–Hochberg limit corresponding to the significance of 0.05 for the given dataset. The numbers in the right bottom corner of each panel indicate the number of genes with P-values below the significance limit and the total number of genes</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Just so you can see the difference using raw and log-space makes (besides the values in the above table), here are two of the replicate samples plotted against each other in raw and log-transformed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(patchwork)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">theme_set</span>(cowplot<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme_cowplot</span>())</span>
<span id="cb5-4"></span>
<span id="cb5-5">raw_plot <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">readRDS</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data_files"</span>, <span class="st" style="color: #20794D;">"raw_plot.rds"</span>))</span>
<span id="cb5-6">raw_p2 <span class="ot" style="color: #003B4F;">=</span> raw_plot <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">slope =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"red"</span>)</span>
<span id="cb5-9">log_plot <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">readRDS</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data_files"</span>, <span class="st" style="color: #20794D;">"log_plot.rds"</span>))</span>
<span id="cb5-10">log_p2 <span class="ot" style="color: #003B4F;">=</span> log_plot <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">slope =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"red"</span>)</span>
<span id="cb5-13">raw_p2 <span class="sc" style="color: #5E5E5E;">+</span> log_p2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/index_files/figure-html/raw_log-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can summarize this behavior across <strong>all</strong> the replicate samples, looking at standard deviation (SD) and relative standard deviation (RSD, SD / mean). I took the counts from Barton group after removing outliers based on median correlations, and then calculate the mean, SD, and RSD across all replicates in each of Snf2 and WT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">data_summary <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">readRDS</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data_files"</span>, <span class="st" style="color: #20794D;">"summary.rds"</span>))</span>
<span id="cb6-2"></span>
<span id="cb6-3">data_summary <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-4">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>(type <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="st" style="color: #20794D;">"diff"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> mean, <span class="at" style="color: #657422;">y =</span> var)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span> type, <span class="at" style="color: #657422;">ncol =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_y"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 494 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/index_files/figure-html/sd_rsd-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>As we can see in the above figure, SD increases with increasing mean. Which is basically what we observe in the pairwise plot above. I’m pretty sure I’ve been taught <strong>not</strong> to do Pearson correlation on data with this structure. Interestingly, the RSD does become rather constant after a certain value in mean expression.</p>
</section>
<section id="how-did-i-miss-the-original-data" class="level2">
<h2 class="anchored" data-anchor-id="how-did-i-miss-the-original-data">How Did I Miss the Original Data?</h2>
<p>Back to the question of finding the original data, it turns out I just didn’t look hard enough at the first place that Geoff Barton sent me to. When I started poking around the figshare repo’s from Geoff and others in the group and following links, it was easy to find a copy of the preprocessed data from each condition.</p>
</section>
<section id="why-was-it-so-hard-to-reproduce-values" class="level2">
<h2 class="anchored" data-anchor-id="why-was-it-so-hard-to-reproduce-values">Why Was it So Hard to Reproduce Values?</h2>
<p>Another interesting thing about this endeavor was just how hard it was to reproduce the correlations. <span class="citation" data-cites="Gierlinski2015">(Gierliński et al. 2015)</span> was actually light on details of how the data was processed, and how the correlation was done. For example, the manuscript just says “Pearson correlation”, with basically no other details. Were raw counts used or log-transformed? Were missing (count of 0) values in either sample removed prior to correlation? It was only when I finally happened across the GitHub repo that I finally got the answers I really needed. And for some reason, that manuscript doesn’t mention the GitHub repo, or the data available on figshare. This points to the importance of citing and linking all the resources for a manuscript (or even a blog post!). And I’m not trying to knock on Marek, or Geoff, or Nick on this. In my experience, they post open things, and provide lots of data. But this highlights just how hard it becomes to recreate something if even a little piece of the data is missing.</p>
</section>
<section id="data-files-and-scripts" class="level2">
<h2 class="anchored" data-anchor-id="data-files-and-scripts">Data Files and Scripts</h2>
<p>The rds files and a processing script to calculate the correlations and generate the plots are all available on the blog directory on GitHub <span class="citation" data-cites="flight_post">(Flight 2022)</span>.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barton2015" class="csl-entry">
Barton, Geoffrey, Mark Blaxter, Christian Cole, Karim Gharbi, Marek Gierliński, Tom Owen-Hughes, Pieta Schofield, et al. 2015. <span>“<span class="nocase">Metadata for a highly replicated two-condition yeast RNAseq experiment.</span>”</span> July. <a href="https://doi.org/10.6084/m9.figshare.1416210.v3">https://doi.org/10.6084/m9.figshare.1416210.v3</a>.
</div>
<div id="ref-SNF2Barton2015" class="csl-entry">
Barton, Geoffrey, Mark Blaxter, Christian Cole, Karim Gharbi, Marek Gierliński, Pieta Schofield, Nick Schurch, Vijender Singh, and Nicola Wrobel. 2015a. <span>“<span class="nocase">SNF2 knock-out yeast gene read counts from a 48 replicate experiment</span>,”</span> May. <a href="https://doi.org/10.6084/m9.figshare.1425502.v1">https://doi.org/10.6084/m9.figshare.1425502.v1</a>.
</div>
<div id="ref-WTBarton2015" class="csl-entry">
———. 2015b. <span>“<span class="nocase">Wild-type yeast gene read counts from 48 replicate experiment</span>,”</span> May. <a href="https://doi.org/10.6084/m9.figshare.1425503.v1">https://doi.org/10.6084/m9.figshare.1425503.v1</a>.
</div>
<div id="ref-bartongithub2015" class="csl-entry">
Cole, Chris, Nick Schurch, Rayna M Harris, and Marek Gierliński. 2015. <span>“profDGE48.”</span> <a href="https://github.com/bartongroup/profDGE48">https://github.com/bartongroup/profDGE48</a>.
</div>
<div id="ref-flight_post" class="csl-entry">
Flight, Robert M. 2022. <span>“Post Files.”</span> <a href="https://github.com/rmflight/researchBlog_distill/tree/main/_posts/2022-01-15-recreating-correlation-values-from-another-manuscript">https://github.com/rmflight/researchBlog_distill/tree/main/_posts/2022-01-15-recreating-correlation-values-from-another-manuscript</a>.
</div>
<div id="ref-icikendalltau" class="csl-entry">
Flight, Robert M, and Hunter NB Moseley. 2021. <span>“ICIKendallTau.”</span> <a href="https://github.com/MoseleyBioinformaticsLab/ICIKendallTau">https://github.com/MoseleyBioinformaticsLab/ICIKendallTau</a>.
</div>
<div id="ref-Gierlinski2015" class="csl-entry">
Gierliński, Marek, Christian Cole, Pietà Schofield, Nicholas J. Schurch, Alexander Sherstnev, Vijender Singh, Nicola Wrobel, et al. 2015. <span>“<span class="nocase">Statistical models for RNA-seq data derived from a two-condition 48-replicate experiment</span>.”</span> <em>Bioinformatics</em> 31 (22): 3625–30. <a href="https://doi.org/10.1093/bioinformatics/btv425">https://doi.org/10.1093/bioinformatics/btv425</a>.
</div>
<div id="ref-Schurch2016" class="csl-entry">
Schurch, Nicholas J., Pietá Schofield, Marek Gierliński, Christian Cole, Alexander Sherstnev, Vijender Singh, Nicola Wrobel, et al. 2016. <span>“How Many Biological Replicates Are Needed in an RNA-Seq Experiment and Which Differential Expression Tool Should You Use?”</span> <em>RNA</em> 22 (6): 839–51. <a href="https://doi.org/10.1261/rna.053959.115">https://doi.org/10.1261/rna.053959.115</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Recreating {Correlation} {Values} from {Another}
    {Manuscript}},
  date = {2022-01-15},
  url = {https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Recreating Correlation Values from Another
Manuscript.”</span> January 15, 2022. <a href="https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript">https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript</a>.
</div></div></section></div> ]]></description>
  <category>reproducibility</category>
  <guid>https://rmflight.github.io/posts/2022-01-15-recreating-correlation-values-from-another-manuscript/index.html</guid>
  <pubDate>Sat, 15 Jan 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Cairo and XQuartz in Mac GitHub Actions</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-01-06-cairo-and-xquartz-in-mac-github-actions/index.html</link>
  <description><![CDATA[ 




<p>I’ve been using GitHub actions to check and test some of my R packages on multiple architectures, which is nice because I work primarily on Linux.</p>
<p>One recent package uses the <code>{Cairo}</code> package to generate images that are subsequently used for visualization <span class="citation" data-cites="cairopackage">(Urbanek and Horner 2020)</span>.</p>
<p>Interestingly, <code>{Cairo}</code> will install fine on MacOS, and then fail as soon as you do <code>library(Cairo)</code>, complaining about not being able to load the {cairo.so} file.</p>
<p>Thankfully, it seems that the GitHub actions MacOS VMs have homebrew <span class="citation" data-cites="homebrew">(<span>“Homebrew”</span> 2022)</span> installed, which means we can use the xquartz brew <span class="citation" data-cites="xquartzbrew">(<span>“Xquartz Homebrew Formulae”</span> 2022)</span> to install it, and have {cairo.so} available.</p>
<p>To add this to your GitHub actions yml, you should add these lines, and double check the brew syntax with the official docs.</p>
<pre><code>    steps:
      - name: Install X11 dependencies on MacOS
        if: runner.os == 'macOS'
        run: |
          brew install --cask xquartz</code></pre>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-homebrew" class="csl-entry">
<span>“Homebrew.”</span> 2022. <a href="https://brew.sh/">https://brew.sh/</a>.
</div>
<div id="ref-cairopackage" class="csl-entry">
Urbanek, Simon, and Jeffrey Horner. 2020. <em>Cairo: R Graphics Device Using Cairo Graphics Library for Creating High-Quality Bitmap (PNG, JPEG, TIFF), Vector (PDF, SVG, PostScript) and Display (X11 and Win32) Output</em>. <a href="https://CRAN.R-project.org/package=Cairo">https://CRAN.R-project.org/package=Cairo</a>.
</div>
<div id="ref-xquartzbrew" class="csl-entry">
<span>“Xquartz Homebrew Formulae.”</span> 2022. <a href="https://formulae.brew.sh/cask/xquartz#default">https://formulae.brew.sh/cask/xquartz#default</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Cairo and {XQuartz} in {Mac} {GitHub} {Actions}},
  date = {2022-01-06},
  url = {https://rmflight.github.io/posts/2022-01-06-cairo-and-xquartz-in-mac-github-actions},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Cairo and XQuartz in Mac GitHub
Actions.”</span> January 6, 2022. <a href="https://rmflight.github.io/posts/2022-01-06-cairo-and-xquartz-in-mac-github-actions">https://rmflight.github.io/posts/2022-01-06-cairo-and-xquartz-in-mac-github-actions</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>cairo</category>
  <category>xquartz</category>
  <category>development</category>
  <category>github</category>
  <category>R</category>
  <guid>https://rmflight.github.io/posts/2022-01-06-cairo-and-xquartz-in-mac-github-actions/index.html</guid>
  <pubDate>Thu, 06 Jan 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Dplyr in Packages and Global Variables</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-01-06-dplyr-in-packages-and-global-variables/index.html</link>
  <description><![CDATA[ 




<p>I was recently cleaning up a development package so it would actually pass checks so it could be hosted on our labs new r-universe <span class="citation" data-cites="moseleyruniverse">(<span>“The ’Moseleybioinformaticslab’ Universe,”</span> n.d.)</span>, and was getting warnings about global variables due to using <code>{dplyr}</code> operations, without {enquoting} variables.</p>
<p>There are a few approaches to handling this.</p>
<ol type="1">
<li>Using {utils::globalvariables} in an R file somewhere.</li>
<li>Using {rlang::.data} and importing it into the package.</li>
</ol>
<p>I went with option <strong>2</strong>, see <span class="citation" data-cites="nobindingsolution">(<span>“How to Solve ’No Visible Binding for Global Variables’,”</span> n.d.)</span>.</p>
<p>In the original version of <code>{dplyr}</code> and other packages like {ggplot2}, there was an option to use “string” arguments, normally by calling the {*_str} or {*_} version of a function name.</p>
<p>That has gone out of fashion, and the way to do it now is to use the .data pronoun <span class="citation" data-cites="dplyrvignette">(<span>“Programming with Dplyr,”</span> n.d.)</span>.</p>
<p>So now the code looks like this:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># an example filtering operation</span></span>
<span id="cb1-2">dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(.data<span class="sc" style="color: #5E5E5E;">$</span>varname <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"value"</span>)</span></code></pre></div>
<p>The easiest way to include this correctly in your package, is by importing the {rlang::.data}.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;">#' @importFrom rlang .data</span></span></code></pre></div>
<p>And all the warnings should go away during package checking.</p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-nobindingsolution" class="csl-entry">
<span>“How to Solve ’No Visible Binding for Global Variables’.”</span> n.d. <a href="https://community.rstudio.com/t/how-to-solve-no-visible-binding-for-global-variable-note/28887/3">https://community.rstudio.com/t/how-to-solve-no-visible-binding-for-global-variable-note/28887/3</a>.
</div>
<div id="ref-dplyrvignette" class="csl-entry">
<span>“Programming with Dplyr.”</span> n.d. <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/programming.html">https://cran.r-project.org/web/packages/dplyr/vignettes/programming.html</a>.
</div>
<div id="ref-moseleyruniverse" class="csl-entry">
<span>“The ’Moseleybioinformaticslab’ Universe.”</span> n.d. <a href="https://moseleybioinformaticslab.r-universe.dev/ui#builds">https://moseleybioinformaticslab.r-universe.dev/ui#builds</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Dplyr in {Packages} and {Global} {Variables}},
  date = {2022-01-06},
  url = {https://rmflight.github.io/posts/2022-01-06-dplyr-in-packages-and-global-variables},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Dplyr in Packages and Global
Variables.”</span> January 6, 2022. <a href="https://rmflight.github.io/posts/2022-01-06-dplyr-in-packages-and-global-variables">https://rmflight.github.io/posts/2022-01-06-dplyr-in-packages-and-global-variables</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>packages</category>
  <category>dplyr</category>
  <category>rlang</category>
  <category>R</category>
  <category>development</category>
  <guid>https://rmflight.github.io/posts/2022-01-06-dplyr-in-packages-and-global-variables/index.html</guid>
  <pubDate>Thu, 06 Jan 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Pie Charts in RCy3</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2022-01-06-pie-charts-in-rcy3/index.html</link>
  <description><![CDATA[ 




<p>I have a package, <code>{categoryCompare2}</code> <span class="citation" data-cites="categorycompare2">(Flight 2022)</span> that I’ve been working on for a while, and recently wanted to make available on our labs r-universe <span class="citation" data-cites="moseleyruniverse">(<span>“The ’Moseleybioinformaticslab’ Universe,”</span> n.d.)</span>.</p>
<p>For some of the <strong>current</strong> visualization, we use Cytoscape to examine annotation similarity graphs, coupling the R together with Cytoscape via <code>{RCy3}</code> <span class="citation" data-cites="rcy3">(Gustavsen et al. 2019)</span>. In the previous iteration, we had used actual piechart images generated by R, and then used <code>setNodeImageDirect</code> to point the node images to local image files.</p>
<p>However, the latest iteration of <code>{RCy3}</code> has essentially lost that functionality. However, there is a new visualization plugin that can do similar things, enhancedGraphics <span class="citation" data-cites="enhancedGraphics">(Morris JH 2014)</span>.</p>
<p>Alexander Pico, one of the primary <code>{RCy3}</code> developers, provided me with the guidance for a code solution <span class="citation" data-cites="piechartissue">(Pico 2022)</span>, which I’ve adapted below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">grp_matrix <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">matrix</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb1-2">                      <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #657422;">nrow =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">ncol =</span> <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb1-3">n_grp <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">nrow</span>(grp_matrix)</span>
<span id="cb1-4">use_color <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rainbow_hcl</span>(<span class="fu" style="color: #4758AB;">ncol</span>(grp_matrix), <span class="at" style="color: #657422;">c =</span> <span class="dv" style="color: #AD0000;">100</span>)</span>
<span id="cb1-5">n_color <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">length</span>(use_color)</span>
<span id="cb1-6">use_color <span class="ot" style="color: #003B4F;">=</span> color</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;"># defines how many pie segments are needed, common to all the pie-charts</span></span>
<span id="cb1-8">pie_area <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rep</span>(<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">/</span> n_color, n_color)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">names</span>(pie_area) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rep</span>(<span class="st" style="color: #20794D;">""</span>, n_color)</span>
<span id="cb1-10"></span>
<span id="cb1-11"></span>
<span id="cb1-12">desat_color <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">desaturate</span>(use_color)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;">names</span>(desat_color) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">names</span>(use_color)</span>
<span id="cb1-14">piechart_strings <span class="ot" style="color: #003B4F;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">map_dfr</span>(<span class="fu" style="color: #4758AB;">rownames</span>(grp_matrix), <span class="cf" style="color: #003B4F;">function</span>(i_grp){</span>
<span id="cb1-15">  tmp_logical <span class="ot" style="color: #003B4F;">&lt;-</span> grp_matrix[i_grp, ]</span>
<span id="cb1-16">  tmp_color <span class="ot" style="color: #003B4F;">&lt;-</span> use_color</span>
<span id="cb1-17">    </span>
<span id="cb1-18">  <span class="co" style="color: #5E5E5E;"># add the proper desaturated versions of the colors</span></span>
<span id="cb1-19">  tmp_color[<span class="sc" style="color: #5E5E5E;">!</span>tmp_logical] <span class="ot" style="color: #003B4F;">&lt;-</span> desat_color[<span class="sc" style="color: #5E5E5E;">!</span>tmp_logical]</span>
<span id="cb1-20">    </span>
<span id="cb1-21">  out_str <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">'piechart: attributelist="'</span>,</span>
<span id="cb1-22">                   <span class="fu" style="color: #4758AB;">paste</span>(<span class="fu" style="color: #4758AB;">colnames</span>(grp_matrix), <span class="at" style="color: #657422;">collapse =</span> <span class="st" style="color: #20794D;">','</span>),</span>
<span id="cb1-23">                   <span class="st" style="color: #20794D;">'" '</span>,</span>
<span id="cb1-24">                   <span class="st" style="color: #20794D;">'colorlist="'</span>,</span>
<span id="cb1-25">                   <span class="fu" style="color: #4758AB;">paste</span>(tmp_color, <span class="at" style="color: #657422;">collapse =</span> <span class="st" style="color: #20794D;">','</span>),</span>
<span id="cb1-26">                   <span class="st" style="color: #20794D;">'" '</span>,</span>
<span id="cb1-27">                   <span class="st" style="color: #20794D;">'arcstart=-90 showlabels=false'</span>)</span>
<span id="cb1-28">  <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">colorlist =</span> out_str)</span>
<span id="cb1-29">})</span>
<span id="cb1-30"></span>
<span id="cb1-31">tmp_matrix <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">as.data.frame</span>(<span class="fu" style="color: #4758AB;">matrix</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">nrow =</span> <span class="fu" style="color: #4758AB;">nrow</span>(piechart_strings),</span>
<span id="cb1-32">                      <span class="at" style="color: #657422;">ncol =</span> <span class="fu" style="color: #4758AB;">ncol</span>(grp_matrix)))</span>
<span id="cb1-33"><span class="fu" style="color: #4758AB;">names</span>(tmp_matrix) <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">colnames</span>(grp_matrix) </span>
<span id="cb1-34">piechart_df <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">cbind</span>(tmp_matrix, piechart_strings)</span>
<span id="cb1-35"></span>
<span id="cb1-36"><span class="co" style="color: #5E5E5E;"># after merging this with the node information to</span></span>
<span id="cb1-37"><span class="co" style="color: #5E5E5E;"># put the right things with the right node</span></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;"># this gives **node_vis_df** below</span></span>
<span id="cb1-39">RCy3<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">setNodeShapeDefault</span>(<span class="st" style="color: #20794D;">"ELLIPSE"</span>)</span>
<span id="cb1-40">RCy3<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">setNodeSizeDefault</span>(<span class="dv" style="color: #AD0000;">35</span>)</span>
<span id="cb1-41">RCy3<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">loadTableData</span>(node_vis_df, <span class="at" style="color: #657422;">data.key.column =</span> <span class="st" style="color: #20794D;">"name"</span>, <span class="at" style="color: #657422;">table =</span> <span class="st" style="color: #20794D;">"node"</span>, <span class="at" style="color: #657422;">table.key.column =</span> <span class="st" style="color: #20794D;">"name"</span>)</span>
<span id="cb1-42">RCy3<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">updateStyleMapping</span>(<span class="st" style="color: #20794D;">"default"</span>,</span>
<span id="cb1-43">   RCy3<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mapVisualProperty</span>(<span class="st" style="color: #20794D;">"NODE_CUSTOMGRAPHICS_1"</span>, <span class="st" style="color: #20794D;">"colorlist"</span>, <span class="st" style="color: #20794D;">"p"</span>))</span></code></pre></div>
</div>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-categorycompare2" class="csl-entry">
Flight, Robert M. 2022. <span>“categoryCompare2.”</span> <a href="https://github.com/MoseleyBioinformaticsLab/categoryCompare2">https://github.com/MoseleyBioinformaticsLab/categoryCompare2</a>.
</div>
<div id="ref-rcy3" class="csl-entry">
Gustavsen, Julia A., Pai, Shraddha, Isserlin, Ruth, Demchak, Barry, Pico, and Alexander R. 2019. <span>“RCy3: Network Biology Using Cytoscape from Within r.”</span> <em>F1000Research</em>. <a href="https://doi.org/10.12688/f1000research.20887.3">https://doi.org/10.12688/f1000research.20887.3</a>.
</div>
<div id="ref-enhancedGraphics" class="csl-entry">
Morris JH, Ferrin TE, Kuchinsky A. 2014. <span>“enhancedGraphics: A Cytoscape App for Enhanced Node Graphics.”</span> <em>F1000Research</em>. <a href="https://doi.org/10.12688/f1000research.4460.1">https://doi.org/10.12688/f1000research.4460.1</a>.
</div>
<div id="ref-piechartissue" class="csl-entry">
Pico, Alexander. 2022. <span>“RCy3 GitHub Issue: Equivalent of setNodeImageDirect.”</span> <a href="https://github.com/cytoscape/RCy3/issues/167#issuecomment-1004467137">https://github.com/cytoscape/RCy3/issues/167#issuecomment-1004467137</a>.
</div>
<div id="ref-moseleyruniverse" class="csl-entry">
<span>“The ’Moseleybioinformaticslab’ Universe.”</span> n.d. <a href="https://moseleybioinformaticslab.r-universe.dev/ui#builds">https://moseleybioinformaticslab.r-universe.dev/ui#builds</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2022,
  author = {Robert M Flight},
  title = {Pie {Charts} in {RCy3}},
  date = {2022-01-06},
  url = {https://rmflight.github.io/posts/2022-01-06-pie-charts-in-rcy3},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2022" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2022. <span>“Pie Charts in RCy3.”</span> January 6,
2022. <a href="https://rmflight.github.io/posts/2022-01-06-pie-charts-in-rcy3">https://rmflight.github.io/posts/2022-01-06-pie-charts-in-rcy3</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>rcy3</category>
  <category>cytoscape</category>
  <category>R</category>
  <guid>https://rmflight.github.io/posts/2022-01-06-pie-charts-in-rcy3/index.html</guid>
  <pubDate>Thu, 06 Jan 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Reusing ggplot2 Colors</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-12-21-reusing-ggplot2-colors/index.html</link>
  <description><![CDATA[ 




<p>If you are using {ggplot2} a lot in your code, and don’t want to bother with a custom color scheme (I mean, there are lots of good options), but you are also using non-ggplot2 type plots, and want to reuse the colors.</p>
<p>I frequently encounter this when I’m doing principal component analysis (PCA) <strong>combined</strong> with heatmaps plotted by <code>{ComplexHeatmap}</code>. I’ve colored sample groups in the PCA using <code>{ggplot2}</code> defaults, and now I want those same colors in the <code>{ComplexHeatmap}</code> row or column annotations.</p>
<p>The trick to this is extracting the <code>palette</code> from the color definition you want. For example, very commonly (in biology at least) we might have 2 classes of samples, cases and controls. So we need 2 colors.</p>
<p>When we generated the {ggplot2} plot, we would do something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">ggplot</span>(data_frame, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> var1, <span class="at" style="color: #657422;">y =</span> var2, <span class="at" style="color: #657422;">color =</span> groups))</span></code></pre></div>
</div>
<p>To generate the matching colors for something else, we can do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">g_colors <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">scale_color_discrete</span>()<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">palette</span>(<span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Reusing Ggplot2 {Colors}},
  date = {2021-12-21},
  url = {https://rmflight.github.io/posts/2021-12-21-reusing-ggplot2-colors},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Reusing Ggplot2 Colors.”</span> December
21, 2021. <a href="https://rmflight.github.io/posts/2021-12-21-reusing-ggplot2-colors">https://rmflight.github.io/posts/2021-12-21-reusing-ggplot2-colors</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>ggplot2</category>
  <category>visualization</category>
  <guid>https://rmflight.github.io/posts/2021-12-21-reusing-ggplot2-colors/index.html</guid>
  <pubDate>Tue, 21 Dec 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Migrating Self-Hosted GitLab Projects to GitHub</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-11-25-migrating-self-hosted-gitlab-projects-to-github/index.html</link>
  <description><![CDATA[ 




<section id="moving-to-github" class="level2">
<h2 class="anchored" data-anchor-id="moving-to-github">Moving to GitHub</h2>
<p>Six years ago, we didn’t really look into what the free academic version of GitHub teams provided for private repositories, and instead decided that we should have a self-hosted GitLab instance. Outside of some weird issues around SSL certificates and reverse proxies (i.e.&nbsp;how our web-hosting worked), this actually worked pretty well. However, instead of making our internal projects public, we would frequently move them over to GitHub. I think this is partly because GitHub has become the de-facto location for open-source tool development. However, it seemed to cause some friction to push things between the two platforms. This may be due to our lab not using git as much as we should be, especially the collaborative aspects in issues and pull requests.</p>
<p>After six years, our PI decided to look into the costs for GitHub teams, and discovered that academic teams get free private repos with rather generous amounts of storage and actions minutes. Therefore, we decided it was time to migrate our projects over to GitHub. The PI delegated this task to yours truly.</p>
</section>
<section id="getting-the-list-of-projects" class="level2">
<h2 class="anchored" data-anchor-id="getting-the-list-of-projects">Getting the List of Projects</h2>
<p>To get the list of projects to migrate, I actually copied the project lists from the web interface. If I was doing this again, I would have just asked for the backup locations of our GitLab projects and used those to get the paths for each project. Some projects had changed their names over time and not updated the corresponding path in the database.</p>
</section>
<section id="users-to-ids" class="level2">
<h2 class="anchored" data-anchor-id="users-to-ids">Users to IDs</h2>
<p>Because I used lists from the web interface, I also had to convert the users to actual IDs that define the paths to each project. These weren’t too hard to look up.</p>
</section>
<section id="local-clones" class="level2">
<h2 class="anchored" data-anchor-id="local-clones">Local Clones</h2>
<p>With a full list of projects as “User Name / Project”, and users to IDs, I could easily script converting users to IDs and the full project path, and then system calls to <code>GIT_SSL_NO_VERIFY=TRUE git clone --mirror gitlab_url</code> to make mirror clones of each project. <code>GIT_SSL_NO_VERIFY=TRUE</code> deals with our labs weird SSL certificate issues, while using <code>--mirror</code> means all the branches are pulled, not just the default branch. This is useful to maintain a history of branches over the course of the project development.</p>
<p>Note that this means you get a directory with “projectName.git”, not just “projectName”. If you look inside the “projectName.git” folder, it’s actually all of the git contents, not the usual files you would see for a normal clone operation.</p>
</section>
<section id="duplicate-projects" class="level2">
<h2 class="anchored" data-anchor-id="duplicate-projects">Duplicate Projects</h2>
<p>One thing I didn’t think about when doing this is that users on GitLab can fork each others projects, resulting in duplicate projects. If I had been smart, I would have cloned the projects into user specific directories. Thankfully, we only had a few duplicate projects where I had to do a second clone to a user specific directory.</p>
</section>
<section id="empty-projects" class="level2">
<h2 class="anchored" data-anchor-id="empty-projects">Empty Projects</h2>
<p>Some of the projects are actually empty, either because we thought we were going to do something and didn’t, or someone just wanted issue tracking (that would be me). These we don’t want to push back up to GitHub. However, empty projects with no commits appear to have less than <strong>two</strong> files in the <code>objects</code> directory, and <strong>zero</strong> files in the <code>objects/pack</code> directory.</p>
</section>
<section id="creating-github-repos" class="level2">
<h2 class="anchored" data-anchor-id="creating-github-repos">Creating GitHub Repos</h2>
<p>I used the GitHub command-line-interface tools (<code>gh</code>) to interface with our GitHub organization. After authorizing the <code>gh</code> tools, for each GitLab project I created a corresponding GitHub project, and then moved to the local clone, and did</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">github_locs <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"/path/to/github/repos"</span></span>
<span id="cb1-2">purrr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">walk</span>(gitlab_project_dirs, <span class="cf" style="color: #003B4F;">function</span>(in_dir){</span>
<span id="cb1-3">  proj_name <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">basename</span>(in_dir)</span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;">setwd</span>(github_locs)</span>
<span id="cb1-5">  gh_command <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"gh repo create --confirm --private orgName/"</span>, proj_name)</span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;">system</span>(gh_command)</span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;">setwd</span>(in_dir)</span>
<span id="cb1-8">  gh_loc <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"git@github.com/orgName/"</span>, proj_name)</span>
<span id="cb1-9">  git_push <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"git push --mirror "</span>, gh_loc)</span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;">system</span>(git_push)</span>
<span id="cb1-11">})</span></code></pre></div>
<p>You can see here I move back and forth between directories a lot, and used system to run <code>gh</code> and <code>git push</code>. It feels a little hacky, but it worked just fine.</p>
</section>
<section id="repos-later" class="level2">
<h2 class="anchored" data-anchor-id="repos-later">190 Repos Later</h2>
<p>I moved over 180 GitLab projects to GitHub repos. With the projects that already had GitHub repos, that means we have over 190 lab repos. That doesn’t count the stuff we left related to testing CI/CD, people learning how to work with GitLab, and 20 copies of the code we use for sys-admin. There were a subset I had to do by hand because of replication issues and not using user directories. I also discovered some missing repos due to a missed letter when copying one lab members user ID.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Migrating {Self-Hosted} {GitLab} {Projects} to {GitHub}},
  date = {2021-11-25},
  url = {https://rmflight.github.io/posts/2021-11-25-migrating-self-hosted-gitlab-projects-to-github},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Migrating Self-Hosted GitLab Projects to
GitHub.”</span> November 25, 2021. <a href="https://rmflight.github.io/posts/2021-11-25-migrating-self-hosted-gitlab-projects-to-github">https://rmflight.github.io/posts/2021-11-25-migrating-self-hosted-gitlab-projects-to-github</a>.
</div></div></section></div> ]]></description>
  <category>version-control</category>
  <category>github</category>
  <category>gitlab</category>
  <guid>https://rmflight.github.io/posts/2021-11-25-migrating-self-hosted-gitlab-projects-to-github/index.html</guid>
  <pubDate>Thu, 25 Nov 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Zooming GGraph Plots</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index.html</link>
  <description><![CDATA[ 




<section id="inspiration" class="level2">
<h2 class="anchored" data-anchor-id="inspiration">Inspiration</h2>
<p>I was recently working with a <strong>largish</strong> graph that I am using the ggraph package, and I needed to zoom into a sub-region of the graph.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">knitr<span class="sc" style="color: #5E5E5E;">::</span>opts_chunk<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">set</span>(<span class="at" style="color: #657422;">warning =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">message =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">fig.width =</span> <span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">fig.height =</span> <span class="dv" style="color: #AD0000;">8</span>)</span>
<span id="cb1-2">example_df <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">structure</span>(<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">from =</span> <span class="fu" style="color: #4758AB;">c</span>(1L, 2L, 3L, 4L, 5L, 6L, 7L, 7L, 7L, 7L, </span>
<span id="cb1-3">                                     7L, 7L, 7L, 7L, 7L, 7L, 8L, 9L, 10L, 11L, 12L, 12L, 12L, 13L, </span>
<span id="cb1-4">                                     13L, 13L, 13L, 13L, 13L, 13L, 14L, 15L, 16L, 16L, 17L, 17L, 18L, </span>
<span id="cb1-5">                                     18L, 19L, 20L, 21L, 21L, 21L, 21L, 21L, 21L, 21L, 21L, 21L, 21L, </span>
<span id="cb1-6">                                     21L, 21L, 22L, 22L, 6L, 23L, 23L, 23L, 23L, 23L, 23L, 23L, 23L, </span>
<span id="cb1-7">                                     23L, 23L, 23L, 23L, 24L, 24L, 24L, 24L, 24L, 24L, 24L, 24L, 24L, </span>
<span id="cb1-8">                                     24L, 24L, 24L, 25L, 25L, 25L, 25L, 25L, 25L, 25L, 25L, 25L, 25L, </span>
<span id="cb1-9">                                     25L, 25L, 26L, 26L, 26L, 26L, 26L, 26L, 26L, 26L, 26L, 26L, 26L, </span>
<span id="cb1-10">                                     26L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, 27L, </span>
<span id="cb1-11">                                     28L, 28L, 28L, 28L, 28L, 28L, 28L, 28L, 28L, 28L, 28L, 28L, 29L, </span>
<span id="cb1-12">                                     29L, 29L, 29L, 29L, 29L, 29L, 29L, 29L, 29L, 29L, 29L, 30L, 30L, </span>
<span id="cb1-13">                                     30L, 30L, 30L, 30L, 30L, 30L, 30L, 30L, 30L, 30L, 31L, 31L, 31L, </span>
<span id="cb1-14">                                     31L, 31L, 31L, 31L, 31L, 31L, 31L, 31L, 31L, 32L, 32L, 32L, 32L, </span>
<span id="cb1-15">                                     32L, 32L, 32L, 32L, 32L, 32L, 32L, 32L, 33L, 33L, 33L, 33L, 33L, </span>
<span id="cb1-16">                                     33L, 33L, 33L, 33L, 33L, 33L, 33L, 34L, 34L, 34L, 34L, 34L, 34L, </span>
<span id="cb1-17">                                     34L, 34L, 34L, 34L, 34L, 34L, 35L, 35L, 35L, 35L, 35L, 35L, 35L, </span>
<span id="cb1-18">                                     35L, 35L, 35L, 35L, 35L, 36L, 36L, 36L, 36L, 36L, 36L, 36L, 36L, </span>
<span id="cb1-19">                                     36L, 36L, 36L, 36L, 37L, 37L, 37L, 37L, 37L, 37L, 37L, 37L, 37L, </span>
<span id="cb1-20">                                     37L, 37L, 37L, 38L, 38L, 38L, 38L, 38L, 38L, 38L, 38L, 38L, 38L, </span>
<span id="cb1-21">                                     38L, 38L, 39L, 39L, 39L, 39L, 39L, 39L, 39L, 39L, 39L, 39L, 39L, </span>
<span id="cb1-22">                                     39L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, 40L, </span>
<span id="cb1-23">                                     41L, 41L, 41L, 41L, 41L, 41L, 41L, 41L, 41L, 41L, 41L, 41L, 42L, </span>
<span id="cb1-24">                                     22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, </span>
<span id="cb1-25">                                     22L, 22L, 22L, 22L, 43L, 43L, 44L, 44L, 45L, 45L, 46L, 46L, 47L, </span>
<span id="cb1-26">                                     47L, 48L, 48L, 49L, 49L, 50L, 50L, 51L, 52L, 52L, 53L, 53L, 54L, </span>
<span id="cb1-27">                                     54L, 55L, 55L, 56L, 57L, 57L, 58L, 58L, 59L, 60L, 61L, 61L, 62L, </span>
<span id="cb1-28">                                     16L, 17L, 18L, 63L, 64L, 65L, 66L, 67L, 68L, 69L, 70L, 71L, 72L, </span>
<span id="cb1-29">                                     73L, 74L, 75L, 76L, 20L, 77L, 77L, 78L, 79L, 79L, 80L, 81L, 82L, </span>
<span id="cb1-30">                                     7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 14L, 15L, 19L, 21L, 21L, </span>
<span id="cb1-31">                                     22L, 83L, 84L, 45L, 46L, 47L, 49L, 50L, 51L, 52L, 53L, 54L, 55L, </span>
<span id="cb1-32">                                     56L, 57L, 58L, 59L, 85L, 48L, 48L, 48L, 48L, 48L, 46L, 46L, 46L, </span>
<span id="cb1-33">                                     46L, 86L, 86L, 13L, 13L, 22L, 7L, 55L, 55L, 55L, 55L, 55L, 51L, </span>
<span id="cb1-34">                                     51L, 51L, 58L, 58L, 58L, 58L, 53L, 53L, 53L, 53L, 49L, 49L, 49L, </span>
<span id="cb1-35">                                     49L, 87L, 87L), <span class="at" style="color: #657422;">to =</span> <span class="fu" style="color: #4758AB;">c</span>(7L, 7L, 7L, 61L, 61L, 61L, 8L, 88L, 89L, </span>
<span id="cb1-36">                                                            90L, 91L, 92L, 93L, 94L, 95L, 96L, 9L, 7L, 9L, 9L, 16L, 17L, </span>
<span id="cb1-37">                                                            18L, 14L, 15L, 16L, 17L, 18L, 19L, 10L, 10L, 10L, 10L, 42L, 10L, </span>
<span id="cb1-38">                                                            42L, 10L, 42L, 10L, 12L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, </span>
<span id="cb1-39">                                                            54L, 55L, 57L, 58L, 6L, 9L, 9L, 45L, 46L, 47L, 48L, 49L, 50L, </span>
<span id="cb1-40">                                                            52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, </span>
<span id="cb1-41">                                                            53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, </span>
<span id="cb1-42">                                                            54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, </span>
<span id="cb1-43">                                                            55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, </span>
<span id="cb1-44">                                                            57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, </span>
<span id="cb1-45">                                                            58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, </span>
<span id="cb1-46">                                                            45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, </span>
<span id="cb1-47">                                                            46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, </span>
<span id="cb1-48">                                                            47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, </span>
<span id="cb1-49">                                                            48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, </span>
<span id="cb1-50">                                                            49L, 50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, </span>
<span id="cb1-51">                                                            50L, 52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, </span>
<span id="cb1-52">                                                            52L, 53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, </span>
<span id="cb1-53">                                                            53L, 54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, </span>
<span id="cb1-54">                                                            54L, 55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, </span>
<span id="cb1-55">                                                            55L, 57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, </span>
<span id="cb1-56">                                                            57L, 58L, 45L, 46L, 47L, 48L, 49L, 50L, 52L, 53L, 54L, 55L, 57L, </span>
<span id="cb1-57">                                                            58L, 9L, 97L, 98L, 99L, 100L, 101L, 4L, 5L, 102L, 10L, 103L, </span>
<span id="cb1-58">                                                            104L, 105L, 60L, 106L, 107L, 108L, 109L, 13L, 22L, 110L, 83L, </span>
<span id="cb1-59">                                                            21L, 44L, 21L, 44L, 21L, 44L, 21L, 44L, 21L, 44L, 21L, 44L, 44L, </span>
<span id="cb1-60">                                                            21L, 44L, 21L, 44L, 21L, 44L, 21L, 44L, 44L, 21L, 44L, 21L, 44L, </span>
<span id="cb1-61">                                                            44L, 111L, 111L, 112L, 60L, 83L, 83L, 83L, 22L, 22L, 22L, 22L, </span>
<span id="cb1-62">                                                            22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 22L, 83L, 83L, 110L, </span>
<span id="cb1-63">                                                            83L, 83L, 110L, 83L, 83L, 22L, 22L, 113L, 114L, 115L, 116L, 117L, </span>
<span id="cb1-64">                                                            118L, 119L, 120L, 121L, 122L, 83L, 83L, 83L, 86L, 2L, 123L, 78L, </span>
<span id="cb1-65">                                                            21L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, 84L, </span>
<span id="cb1-66">                                                            84L, 84L, 10L, 79L, 124L, 86L, 125L, 84L, 79L, 124L, 86L, 125L, </span>
<span id="cb1-67">                                                            110L, 83L, 42L, 11L, 126L, 111L, 48L, 79L, 124L, 86L, 125L, 79L, </span>
<span id="cb1-68">                                                            86L, 125L, 79L, 124L, 86L, 125L, 79L, 124L, 86L, 125L, 79L, 124L, </span>
<span id="cb1-69">                                                            86L, 125L, 46L, 48L)), <span class="at" style="color: #657422;">class =</span> <span class="st" style="color: #20794D;">"data.frame"</span>, <span class="at" style="color: #657422;">row.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="cn" style="color: #8f5902;">NA</span>, </span>
<span id="cb1-70">                                                                                                                       <span class="sc" style="color: #5E5E5E;">-</span>432L))</span>
<span id="cb1-71"></span>
<span id="cb1-72"><span class="fu" style="color: #4758AB;">library</span>(ggraph)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(tidygraph)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidygraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(igraph)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'igraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidygraph':

    groups</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    decompose, spectrum</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">example_graph <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">as_tbl_graph</span>(example_df)</span></code></pre></div>
</div>
</section>
<section id="initial-view" class="level2">
<h2 class="anchored" data-anchor-id="initial-view">Initial View</h2>
<p>Let’s generate a plot of this to start.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;">ggraph</span>(example_graph, <span class="st" style="color: #20794D;">"graphopt"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">geom_edge_link</span>(<span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">'mm'</span>)),</span>
<span id="cb12-4">                <span class="at" style="color: #657422;">end_cap =</span> <span class="fu" style="color: #4758AB;">circle</span>(<span class="dv" style="color: #AD0000;">10</span>, <span class="st" style="color: #20794D;">"mm"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;">geom_node_point</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index_files/figure-html/plot_full-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>You can see the bottom left section of this graph looks like a mess. It sure would be awesome if we could zoom into that region, and replot it.</p>
</section>
<section id="find-those-nodes" class="level2">
<h2 class="anchored" data-anchor-id="find-those-nodes">Find Those Nodes</h2>
<p>We will use <code>igraph</code>s community detection to break this into community sets and select the correct group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">walk_membership <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">cluster_walktrap</span>(example_graph)</span>
<span id="cb13-2">walk_communities <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">membership</span>(walk_membership)</span>
<span id="cb13-3">split_comms <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">split</span>(<span class="fu" style="color: #4758AB;">names</span>(walk_communities), walk_communities)</span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;">names</span>(split_comms) <span class="ot" style="color: #003B4F;">=</span> <span class="cn" style="color: #8f5902;">NULL</span></span>
<span id="cb13-5"></span>
<span id="cb13-6">which_comm <span class="ot" style="color: #003B4F;">=</span> split_comms[[<span class="fu" style="color: #4758AB;">which</span>(purrr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">map_lgl</span>(split_comms, <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"58"</span> <span class="sc" style="color: #5E5E5E;">%in%</span> .x))]]</span></code></pre></div>
</div>
</section>
<section id="initial-layout" class="level2">
<h2 class="anchored" data-anchor-id="initial-layout">Initial Layout</h2>
<p>One way to make sure we can get the same layout is to create the layout, which is treated as a graph by ggraph.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;"># we set the seed so its the same layout as previous</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb14-3">example_layout <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">create_layout</span>(example_graph, <span class="st" style="color: #20794D;">"graphopt"</span>)</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="fu" style="color: #4758AB;">ggraph</span>(example_layout) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;">geom_edge_link</span>(<span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">'mm'</span>)),</span>
<span id="cb14-7">                <span class="at" style="color: #657422;">end_cap =</span> <span class="fu" style="color: #4758AB;">circle</span>(<span class="dv" style="color: #AD0000;">10</span>, <span class="st" style="color: #20794D;">"mm"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;">geom_node_point</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index_files/figure-html/initial_layout-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Awesome, looks the same as the previous.</p>
</section>
<section id="subset-nodes-and-get-range" class="level2">
<h2 class="anchored" data-anchor-id="subset-nodes-and-get-range">Subset Nodes and Get Range</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">sub_layout <span class="ot" style="color: #003B4F;">=</span> example_layout <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb15-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(name <span class="sc" style="color: #5E5E5E;">%in%</span> which_comm)</span>
<span id="cb15-3">sub_xlim <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">range</span>(sub_layout<span class="sc" style="color: #5E5E5E;">$</span>x)</span>
<span id="cb15-4">sub_ylim <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">range</span>(sub_layout<span class="sc" style="color: #5E5E5E;">$</span>y)</span></code></pre></div>
</div>
</section>
<section id="plot-subset" class="level2">
<h2 class="anchored" data-anchor-id="plot-subset">Plot Subset</h2>
<p>We would think we should be able to just use the sub-layout to plot the subset of nodes. Lets try that first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;">ggraph</span>(sub_layout) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">geom_edge_link</span>(<span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">'mm'</span>)),</span>
<span id="cb16-3">                <span class="at" style="color: #657422;">end_cap =</span> <span class="fu" style="color: #4758AB;">circle</span>(<span class="dv" style="color: #AD0000;">10</span>, <span class="st" style="color: #20794D;">"mm"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;">geom_node_point</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index_files/figure-html/plot_subset-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>As we can see, this isn’t quite right. We are missing some of the edges.</p>
</section>
<section id="plot-using-subset-ranges" class="level2">
<h2 class="anchored" data-anchor-id="plot-using-subset-ranges">Plot Using Subset Ranges</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">ggraph</span>(example_layout) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;">geom_edge_link</span>(<span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">'mm'</span>)),</span>
<span id="cb17-3">                <span class="at" style="color: #657422;">end_cap =</span> <span class="fu" style="color: #4758AB;">circle</span>(<span class="dv" style="color: #AD0000;">10</span>, <span class="st" style="color: #20794D;">"mm"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;">geom_node_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;">coord_cartesian</span>(<span class="at" style="color: #657422;">xlim =</span> sub_xlim, <span class="at" style="color: #657422;">ylim =</span> sub_ylim)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index_files/figure-html/plot_ranges-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Finally! This is what we wanted. And we can see why it’s so overlapped in the full plot! It’s pretty much a hairball in that part of the graph.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Zooming {GGraph} {Plots}},
  date = {2021-11-11},
  url = {https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Zooming GGraph Plots.”</span> November 11,
2021. <a href="https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots">https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots</a>.
</div></div></section></div> ]]></description>
  <category>graphing</category>
  <category>ggraph</category>
  <category>visualization</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2021-11-11-zooming-ggraph-plots/index.html</guid>
  <pubDate>Thu, 11 Nov 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>R CMD Check and Non-PDF Vignettes</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-10-27-r-cmd-check-and-non-pdf-vignettes/index.html</link>
  <description><![CDATA[ 




<section id="r-cmd-check" class="level2">
<h2 class="anchored" data-anchor-id="r-cmd-check">R CMD Check</h2>
<p>If you’ve written an R package that you want hosted by CRAN (or even if not hosted), then you generally want to run the infamous <code>R CMD check</code> on your package.</p>
<p>Although it can be a pain in the butt, it has a wide array of checks that make sense (and some that don’t, just look at posts on the R-devel list).</p>
</section>
<section id="missing-files" class="level2">
<h2 class="anchored" data-anchor-id="missing-files">Missing Files</h2>
<p>If you are using <code>rmarkdown</code> to generate non-standard vignettes, or even using <code>rmarkdown</code> because of features that aren’t present directly in <code>knitr</code>, then the <strong>check</strong> process may fail after it re-builds the package. You may see this message:</p>
<pre><code>Warning: Files in the 'vignettes' directory but no files in 'inst/doc':
  ‘vignette_file.Rmd’</code></pre>
<p>The solution, as far as I can tell, is to:</p>
<ul>
<li>add both <code>knitr</code> and <code>rmarkdown</code> to the <strong>Suggests</strong> field of DESCRIPTION.</li>
<li>add <strong>VignetteBuilder: knitr</strong> to the DESCRIPTION.</li>
<li>add <code>%\VignetteEngine{knitr::rmarkdown}</code> to the vignette meta-data.</li>
<li>use <strong>output: …</strong> whatever actual output document type you wanted in the vignette itself.</li>
</ul>
<p>I think that the <strong>build</strong> command only recognizes the <code>knitr</code> engine properly, and that is the only one that builds the vignettes and shoves them in the right location.</p>
<p>Otherwise, you should build them manually and double check the options to <strong>build</strong> and <strong>check</strong> so that vignettes don’t get rebuilt during either build or check.</p>
<p>Depending on your needs, you might want to use something like Drew Schmidt’s approach <span class="citation" data-cites="vignettelessarticles">(<span>“Vignette-Less Articles with Pkgdown”</span> 2020)</span>.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-vignettelessarticles" class="csl-entry">
<span>“Vignette-Less Articles with Pkgdown.”</span> 2020. <a href="https://fml-fam.github.io/blog/2020/06/23/vignette-less-articles-with-pkgdown/">https://fml-fam.github.io/blog/2020/06/23/vignette-less-articles-with-pkgdown/</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {R {CMD} {Check} and {Non-PDF} {Vignettes}},
  date = {2021-10-27},
  url = {https://rmflight.github.io/posts/2021-10-27-r-cmd-check-and-non-pdf-vignettes},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“R CMD Check and Non-PDF Vignettes.”</span>
October 27, 2021. <a href="https://rmflight.github.io/posts/2021-10-27-r-cmd-check-and-non-pdf-vignettes">https://rmflight.github.io/posts/2021-10-27-r-cmd-check-and-non-pdf-vignettes</a>.
</div></div></section></div> ]]></description>
  <category>packages</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2021-10-27-r-cmd-check-and-non-pdf-vignettes/index.html</guid>
  <pubDate>Wed, 27 Oct 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>My Vacation in Barometric Pressure</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index.html</link>
  <description><![CDATA[ 




<section id="the-what" class="level2">
<h2 class="anchored" data-anchor-id="the-what">The What?</h2>
<p>I recently took a proper vacation, that involved driving from Lexington, KY, USA to Digby, NS, Canada and all points in between. I also have an app, <a href="https://play.google.com/store/apps/details?id=net.hubalek.android.apps.barometer&amp;hl=en_US&amp;gl=US">Barometer Reborn</a>, on my phone that measures the air pressure every 15 minutes or so. This data is useful for someone who suffers from pressure induced migraines. I decided it would be interesting to examine the air pressure readings over the course of my vacation, given that we crossed an extremely wide variety of terrain (and weather) in our travels.</p>
<p>So lets see what kinds of things we can see. A big caveat with this data is that we are essentially recording local pressure, a combination of pressure changes from both elevation and weather changes, as I don’t have the correction for elevation turned on. I think it will still be interesting to examine whats in here.</p>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<p>I’ve previously uploaded data to Google Drive from my phone and downloaded it. Although it says “csv”, it turns out it’s actually tab-separated. I also do the conversion to a date-time format explicitly here, because it was easier than parsing the date format that the app uses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(ggforce)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">theme_set</span>(cowplot<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme_cowplot</span>())</span>
<span id="cb5-4">barometer_readings <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">read.table</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data_files/barometer_2021-09-17.csv"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\t</span><span class="st" style="color: #20794D;">"</span>, <span class="at" style="color: #657422;">header =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-5">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pressure =</span> Pressure..mBar.,</span>
<span id="cb5-6">                <span class="at" style="color: #657422;">datetime =</span> lubridate<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">as_datetime</span>(Timestamp..Unix.Time. <span class="sc" style="color: #5E5E5E;">/</span> <span class="dv" style="color: #AD0000;">1000</span>, <span class="at" style="color: #657422;">tz =</span> <span class="st" style="color: #20794D;">"America/New_York"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-7">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(datetime <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="st" style="color: #20794D;">"2021-08-21"</span>, datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-15"</span>)</span></code></pre></div>
</div>
</section>
<section id="initial-plot" class="level2">
<h2 class="anchored" data-anchor-id="initial-plot">Initial Plot</h2>
<p>We can plot the whole thing, with the pressure at sea level as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">ggplot</span>(barometer_readings, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> datetime,</span>
<span id="cb6-2">                               <span class="at" style="color: #657422;">y =</span> pressure)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">1.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="at" style="color: #657422;">yintercept =</span> <span class="fl" style="color: #AD0000;">1013.25</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"red"</span>, <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">1.5</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Date"</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Pressure (mBar)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/plot_them-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is kinda cool. At both ends it’s easy to see the passage there and back through the mountains (not big ones, but still)! It’s also easy to see that outside of those, I spent a lot of time near sea level, which is expected from Bangor, ME on.</p>
</section>
<section id="annotations" class="level2">
<h2 class="anchored" data-anchor-id="annotations">Annotations</h2>
<p>Let’s annotate it! We can come up with some simple annotations, like the driving sections, and then when we were in a location, and add those to the plot. The (1) and (2) labels are to keep from having weird plot artifacts appearing in the line plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">barometer_readings <span class="ot" style="color: #003B4F;">=</span> barometer_readings <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">location =</span></span>
<span id="cb7-3">   dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb7-4">     </span>
<span id="cb7-5">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-22 08:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Lexington - Bangor"</span>,</span>
<span id="cb7-6">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-23 08:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Waiting on Covid Test"</span>,</span>
<span id="cb7-7">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-23 19:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Bangor - Digby"</span>,</span>
<span id="cb7-8">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-28 08:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Digby 1"</span>,</span>
<span id="cb7-9">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-08-28 14:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Daytrip to Liverpool"</span>,</span>
<span id="cb7-10">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-03 10:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Digby 2"</span>,</span>
<span id="cb7-11">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-03 16:30"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Digby - Burton"</span>,</span>
<span id="cb7-12">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-08 09:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Burton 1"</span>,</span>
<span id="cb7-13">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-08 20:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Daytrip to Moncton"</span>,</span>
<span id="cb7-14">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-13 08:00"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Burton 2"</span>,</span>
<span id="cb7-15">     datetime <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="st" style="color: #20794D;">"2021-09-15"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Burton - Lexington"</span></span>
<span id="cb7-16">   ),</span>
<span id="cb7-17">   <span class="at" style="color: #657422;">day =</span> lubridate<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">as_date</span>(datetime))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">big_plot <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">ggplot</span>(barometer_readings, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> datetime, <span class="at" style="color: #657422;">y =</span> pressure, <span class="at" style="color: #657422;">color =</span> location)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">1.5</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">0.2</span>, <span class="fl" style="color: #AD0000;">0.3</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Date"</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Pressure (mBar)"</span>)</span>
<span id="cb8-5">big_plot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/plot_full-1.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">big_plot2 <span class="ot" style="color: #003B4F;">=</span> big_plot <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p>We can plot some of these as subsets and zoom in on them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">big_plot2 <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">facet_zoom</span>(<span class="at" style="color: #657422;">x =</span> location <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Lexington - Bangor"</span>, <span class="st" style="color: #20794D;">"Waiting on Covid Test"</span>, <span class="st" style="color: #20794D;">"Bangor - Digby"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Going from Lexington to Bangor, awaiting test results, and then driving to Digby."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/section1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">big_plot2 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">facet_zoom</span>(<span class="at" style="color: #657422;">x =</span> location <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Digby 1"</span>, <span class="st" style="color: #20794D;">"Daytrip to Liverpool"</span>, <span class="st" style="color: #20794D;">"Digby 2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Digby, with a trip across land to Liverpool."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/section2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">big_plot2 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">facet_zoom</span>(<span class="at" style="color: #657422;">x =</span> location <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Digby - Burton"</span>, <span class="st" style="color: #20794D;">"Burton 1"</span>, <span class="st" style="color: #20794D;">"Daytrip to Moncton"</span>, <span class="st" style="color: #20794D;">"Burton 2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Traveling from Digby to Burton, a daytrip to Moncton, and remainder in Burton."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/section3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can actually see towards the tail end of our stay in Burton, the big increase in local pressure from a high-front that gave me a massive migraine and kept me home from activities with the family. Thankfully that was the only one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">big_plot2 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">facet_zoom</span>(<span class="at" style="color: #657422;">x =</span> <span class="fu" style="color: #4758AB;">as.character</span>(day) <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"2021-09-10"</span>, <span class="st" style="color: #20794D;">"2021-09-11"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Migraine day, stayed home."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/migraine-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">big_plot2 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">facet_zoom</span>(<span class="at" style="color: #657422;">x =</span> location <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Burton - Lexington"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Traveling home to Lexington from Burton over 2 days."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index_files/figure-html/section4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>I dunno, honestly. This would probably be more interesting if it was one or the other of changes due to altitude, or due to changes in the weather with an adjustment for the altitude. Many of the dips are due to changes occurring because of a change in altitude, with the biggest ones noted as we drove through the Appalachian mountains.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {My {Vacation} in {Barometric} {Pressure}},
  date = {2021-09-20},
  url = {https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“My Vacation in Barometric
Pressure.”</span> September 20, 2021. <a href="https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure">https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure</a>.
</div></div></section></div> ]]></description>
  <category>graphing</category>
  <category>maps</category>
  <category>visualization</category>
  <guid>https://rmflight.github.io/posts/2021-09-20-my-vacation-in-barometric-pressure/index.html</guid>
  <pubDate>Mon, 20 Sep 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Random Forest Classification Using Parsnip</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-08-30-random-forest-classification-using-parsnip/index.html</link>
  <description><![CDATA[ 




<p>I’ve been working on a “machine learning” project, and in the process I’ve been learning to use the tidymodels framework <span class="citation" data-cites="tidymodelsSite">(<span>“Tidymodels”</span> 2021)</span>, which helps save you from leaking information from testing to training data, as well as creating workflows in a consistent way across methods.</p>
<p>However, I got tripped up recently by one issue. When I’ve previously used Random Forests <span class="citation" data-cites="rfWiki">(<span>“Random Forest Wiki Page”</span> 2021)</span>, I’ve found that for <strong>classification</strong> problems, the out-of-bag (OOB) error reported is a good proxy for the area-under-the-curve (AUC), or estimate of how good any other machine learning technique will do (see <span class="citation" data-cites="flight2015random">(Flight 2015)</span> for an example using actual random data). Therefore, I like to put my data through a Random Forest algorithm and check the OOB error, and then maybe reach for a tuned boosted tree to squeeze every last bit of performance out.</p>
<p>tidymodels default is to use a <code>probability</code> tree, even for classification problems. This isn’t normally a problem for most people, because you will have a train and test set, and estimate performance on the test set using AUC. However, it is a problem if you just want to see the OOB error from the random forest, because it is reported differently for probability vs classification.</p>
<p>Lets run an example using the tidymodels <em>cell</em> data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidymodels)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(modeldata)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(skimr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">data</span>(cells, <span class="at" style="color: #657422;">package =</span> <span class="st" style="color: #20794D;">"modeldata"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(ranger)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">tidymodels_prefer</span>()</span>
<span id="cb1-7"></span>
<span id="cb1-8">cells<span class="sc" style="color: #5E5E5E;">$</span>case <span class="ot" style="color: #003B4F;">=</span> <span class="cn" style="color: #8f5902;">NULL</span></span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;">ranger</span>(class <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> cells, <span class="at" style="color: #657422;">min.node.size =</span> <span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">classification =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger(class ~ ., data = cells, min.node.size = 10, classification = TRUE) 

Type:                             Classification 
Number of trees:                  500 
Sample size:                      2019 
Number of independent variables:  56 
Mtry:                             7 
Target node size:                 10 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error:             17.29 % </code></pre>
</div>
</div>
<p>Here we can see that we get an OOB error of 17%, which isn’t too shabby. Now, let’s setup a workflow to do the same thing via tidymodels parsnip.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">rf_spec <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">rand_forest</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">set_engine</span>(<span class="st" style="color: #20794D;">"ranger"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">set_mode</span>(<span class="st" style="color: #20794D;">"classification"</span>)</span>
<span id="cb3-4"></span>
<span id="cb3-5">rf_recipe <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">recipe</span>(class <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> cells) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">step_dummy</span>(class, <span class="sc" style="color: #5E5E5E;">-</span>class)</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rf_recipe) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">add_model</span>(rf_spec) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;">fit</span>(<span class="at" style="color: #657422;">data =</span> cells)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
1 Recipe Step

• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1), probability = TRUE) 

Type:                             Probability estimation 
Number of trees:                  500 
Sample size:                      2019 
Number of independent variables:  56 
Mtry:                             7 
Target node size:                 10 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error (Brier s.):  0.1198456 </code></pre>
</div>
</div>
<p>Here we see the OOB error is 12% (0.119), which is not significantly different than the 17% above, but still different. Also, the “Type” shows “Probability estimation” instead of “Classification estimation”.</p>
<p>If we run ranger again with a “probability” instead of “classification”, do we match up with the result above?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">ranger</span>(class <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> cells, <span class="at" style="color: #657422;">min.node.size =</span> <span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">probability =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger(class ~ ., data = cells, min.node.size = 10, probability = TRUE) 

Type:                             Probability estimation 
Number of trees:                  500 
Sample size:                      2019 
Number of independent variables:  56 
Mtry:                             7 
Target node size:                 10 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error (Brier s.):  0.119976 </code></pre>
</div>
</div>
<p>That is much closer to the tidymodels result! Great! Except, it’s a misestimation of the true OOB error for classification. How do we get what we want while using the tidymodels framework?</p>
<p>I couldn’t find the answer, and the above <strong>looked</strong> like a bug, so I filed one on the parsnip github <span class="citation" data-cites="parsnipIssue">(<span>“Ranger "Classification" Mode Still Looks Like "Probability"”</span> 2021)</span>. Julia Silge helpfully provided the solution to my problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">rf_spec_class <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">rand_forest</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">set_engine</span>(<span class="st" style="color: #20794D;">"ranger"</span>, <span class="at" style="color: #657422;">probability =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">set_mode</span>(<span class="st" style="color: #20794D;">"classification"</span>)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rf_recipe) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;">add_model</span>(rf_spec_class) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;">fit</span>(<span class="at" style="color: #657422;">data =</span> cells)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
1 Recipe Step

• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, probability = ~FALSE,      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1)) 

Type:                             Classification 
Number of trees:                  500 
Sample size:                      2019 
Number of independent variables:  56 
Mtry:                             7 
Target node size:                 1 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error:             16.54 % </code></pre>
</div>
</div>
<p>Aha! Now we are much closer to the original value of 17%, and the “Type” is “Classification”.</p>
<p>I know in this case, the differences in OOB error are honestly not that much different, but in my recent project, they differed by 20%, where I had a 45% using classification, and 25% using probability. Therefore, I was being fooled by the tidymodels framework investigation, and then wondering why my final AUC on a tuned model was only hitting just &gt; 55%.</p>
<p>So remember, this isn’t how I would run the model for final classification and estimation of AUC on a test set, but if you want the OOB errors for a quick “feel” of your data, it’s very useful.</p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-flight2015random" class="csl-entry">
Flight, Robert M. 2015. <span>“Deciphering Life: One Bit at a Time: Random Forest Vs PLS on Random Data.”</span> <a href="https://rmflight.github.io/posts/2015-12-12-random-forest-vs-pls-on-random-data/">https://rmflight.github.io/posts/2015-12-12-random-forest-vs-pls-on-random-data/</a>.
</div>
<div id="ref-rfWiki" class="csl-entry">
<span>“Random Forest Wiki Page.”</span> 2021. <a href="https://en.wikipedia.org/wiki/Random_forest">https://en.wikipedia.org/wiki/Random_forest</a>.
</div>
<div id="ref-parsnipIssue" class="csl-entry">
<span>“Ranger "Classification" Mode Still Looks Like "Probability".”</span> 2021. <a href="https://github.com/tidymodels/parsnip/issues/546">https://github.com/tidymodels/parsnip/issues/546</a>.
</div>
<div id="ref-tidymodelsSite" class="csl-entry">
<span>“Tidymodels.”</span> 2021. <a href="https://www.tidymodels.org/">https://www.tidymodels.org/</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Random {Forest} {Classification} {Using} {Parsnip}},
  date = {2021-08-30},
  url = {https://rmflight.github.io/posts/2021-08-30-random-forest-classification-using-parsnip},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Random Forest Classification Using
Parsnip.”</span> August 30, 2021. <a href="https://rmflight.github.io/posts/2021-08-30-random-forest-classification-using-parsnip">https://rmflight.github.io/posts/2021-08-30-random-forest-classification-using-parsnip</a>.
</div></div></section></div> ]]></description>
  <category>parsnip</category>
  <category>tidymodels</category>
  <category>machine-learning</category>
  <category>random-forest</category>
  <category>random-code-snippets</category>
  <guid>https://rmflight.github.io/posts/2021-08-30-random-forest-classification-using-parsnip/index.html</guid>
  <pubDate>Mon, 30 Aug 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Coloring Dendrogram Edges with ggraph</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph/index.html</link>
  <description><![CDATA[ 




<p>I wanted to color the dendrogram edges according to their class in ggraph, and I was getting stuck because of something that isn’t explicitly mentioned in the documentation, but is implied. <strong>You must use “node.” to access the data from the Node Data in the call to <code>aes(...)</code></strong>.</p>
<p>Lets set it up. We will borrow from the “Edges” vignette in the ggraph package <span class="citation" data-cites="ggraphEdgesVignette">(Pederson 2021)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(ggraph)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(tidygraph)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidygraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(purrr)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">library</span>(rlang)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rlang'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:purrr':

    %@%, as_function, flatten, flatten_chr, flatten_dbl, flatten_int,
    flatten_lgl, flatten_raw, invoke, splice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">set_graph_style</span>(<span class="at" style="color: #657422;">plot_margin =</span> <span class="fu" style="color: #4758AB;">margin</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">1</span>))</span>
<span id="cb9-2">hierarchy <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as_tbl_graph</span>(<span class="fu" style="color: #4758AB;">hclust</span>(<span class="fu" style="color: #4758AB;">dist</span>(iris[, <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">4</span>]))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Class =</span> <span class="fu" style="color: #4758AB;">map_bfs_back_chr</span>(<span class="fu" style="color: #4758AB;">node_is_root</span>(), <span class="at" style="color: #657422;">.f =</span> <span class="cf" style="color: #003B4F;">function</span>(node, path, ...) {</span>
<span id="cb9-4">    <span class="cf" style="color: #003B4F;">if</span> (leaf[node]) {</span>
<span id="cb9-5">      <span class="fu" style="color: #4758AB;">as.character</span>(iris<span class="sc" style="color: #5E5E5E;">$</span>Species[<span class="fu" style="color: #4758AB;">as.integer</span>(label[node])])</span>
<span id="cb9-6">    } <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb9-7">      species <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">unique</span>(<span class="fu" style="color: #4758AB;">unlist</span>(path<span class="sc" style="color: #5E5E5E;">$</span>result))</span>
<span id="cb9-8">      <span class="cf" style="color: #003B4F;">if</span> (<span class="fu" style="color: #4758AB;">length</span>(species) <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>) {</span>
<span id="cb9-9">        species</span>
<span id="cb9-10">      } <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb9-11">        <span class="cn" style="color: #8f5902;">NA_character_</span></span>
<span id="cb9-12">      }</span>
<span id="cb9-13">    }</span>
<span id="cb9-14">  }))</span>
<span id="cb9-15"></span>
<span id="cb9-16">hierarchy</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tbl_graph: 299 nodes and 298 edges
#
# A rooted tree
#
# Node Data: 299 × 5 (active)
  height leaf  label members Class    
   &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    
1  0     TRUE  "108"       1 virginica
2  0     TRUE  "131"       1 virginica
3  0.265 FALSE ""          2 virginica
4  0     TRUE  "103"       1 virginica
5  0     TRUE  "126"       1 virginica
6  0     TRUE  "130"       1 virginica
# … with 293 more rows
#
# Edge Data: 298 × 2
   from    to
  &lt;int&gt; &lt;int&gt;
1     3     1
2     3     2
3     7     5
# … with 295 more rows</code></pre>
</div>
</div>
<p>And with this, we can create a dendrogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">ggraph</span>(hierarchy, <span class="st" style="color: #20794D;">"dendrogram"</span>, <span class="at" style="color: #657422;">height =</span> height) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">geom_edge_elbow</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph/index_files/figure-html/plot_dendrogram-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nice! But what if we want the leaves colored by which “Class” they belong to?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;">ggraph</span>(hierarchy, <span class="st" style="color: #20794D;">"dendrogram"</span>, <span class="at" style="color: #657422;">height =</span> height) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">geom_edge_elbow2</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color =</span> node.Class))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph/index_files/figure-html/plot_class-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note the differences in this function call compared to the previous:</p>
<ol type="1">
<li>Using <code>geom_edge_elbow2</code> instead of <code>geom_edge_elbow</code></li>
<li>Using <code>node.Class</code>, not just <code>Class</code>.</li>
</ol>
<p>The second point is really important! When you look at the <code>hierarchy</code> object printed above, the <code>Class</code> bit is part of the <code>Node Data</code>, which gets identified by <code>ggraph</code> by the prefix “node.”.</p>
<p>If we don’t use <code>node.Class</code>, here is the error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;">ggraph</span>(hierarchy, <span class="st" style="color: #20794D;">"dendrogram"</span>, <span class="at" style="color: #657422;">height =</span> height) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">geom_edge_elbow2</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color =</span> Class))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `geom_edge_elbow2()`:
! Problem while computing aesthetics.
ℹ Error occurred in the 1st layer.
Caused by error in `FUN()`:
! object 'Class' not found</code></pre>
</div>
</div>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ggraphEdgesVignette" class="csl-entry">
Pederson, Thomas Lin. 2021. <span>“Edges.”</span> <a href="https://cran.r-project.org/web/packages/ggraph/vignettes/Edges.html">https://cran.r-project.org/web/packages/ggraph/vignettes/Edges.html</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Coloring {Dendrogram} {Edges} with Ggraph},
  date = {2021-08-03},
  url = {https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Coloring Dendrogram Edges with
Ggraph.”</span> August 3, 2021. <a href="https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph">https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>visualization</category>
  <category>graphing</category>
  <category>dendrogram</category>
  <guid>https://rmflight.github.io/posts/2021-08-03-coloring-dendrogram-edges-with-ggraph/index.html</guid>
  <pubDate>Tue, 03 Aug 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Keeping Figures in an Rmd – Word Document</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-07-22-keep-figures-in-a-word-document/index.html</link>
  <description><![CDATA[ 




<p>I’ve been working with a lot of collaborators who expect Word documents lately. I don’t really like it, but it makes it a lot easier for them to edit and work with things back and forth. So I’ve really been working on generating nice output in the Word document.</p>
<p>Recently, someone brought up collecting the figures for a manuscript for submission. For those in the know, when you submit a manuscript, you often submit the text with or without figures embedded, and then you also submit “high” resolution figure files separately (yes it’s annoying, but that’s the way it is for many submission systems). Now, you could plot twice in each chunk, but thats freaking annoying. Ideally, Rmarkdown or knitr should do all the work for us. And thanks to the R Markdown Cookbook <span class="citation" data-cites="rmarkdowncookbook">(Xie 2021)</span>, there is a simple way to do this.</p>
<p>In the yaml preamble, simply set the parameter: <code>keep_md: true</code>, like this:</p>
<pre><code>output:
  word_document:
    keep_md: true</code></pre>
<p>Alternatively, if using Quarto:</p>
<pre><code>output:
  docx:
    keep-md: true</code></pre>
<p>This means the markdown intermediate is kept, as well as the directory of figures. The figures will be named with the name of the chunk, so you will want to name your chunks well to make it easy to find the figures.</p>
<p>You can also control <strong>where</strong> your figures get written to, as well as the default figure size, output type, and resolution.</p>
<p>This chunk sets the directory (path) the dpi to 300, to use cairo PNG output, the figure width to 8 in, height to 5 in. And then creates the directory (which I’m sure knitr does, but this is for my own sanity).</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;"># the trailing slash is important!</span></span>
<span id="cb3-2">fig_dir <span class="ot" style="color: #003B4F;">=</span> here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"doc"</span>, <span class="st" style="color: #20794D;">"figure_directory/"</span>) </span>
<span id="cb3-3">knitr<span class="sc" style="color: #5E5E5E;">::</span>opts_chunk<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">set</span>(<span class="at" style="color: #657422;">echo =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">warning =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">dpi =</span> <span class="dv" style="color: #AD0000;">300</span>,</span>
<span id="cb3-4">                      <span class="at" style="color: #657422;">dev.args =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">png =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">type =</span> <span class="st" style="color: #20794D;">"cairo"</span>)),</span>
<span id="cb3-5">                      <span class="at" style="color: #657422;">fig.width =</span> <span class="dv" style="color: #AD0000;">8</span>, <span class="at" style="color: #657422;">fig.height =</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb3-6">                      <span class="at" style="color: #657422;">fig.path =</span> fig_dir)</span>
<span id="cb3-7"><span class="cf" style="color: #003B4F;">if</span> (<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">dir.exists</span>(fig_dir)) {</span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">dir.create</span>(fig_dir)</span>
<span id="cb3-9">}</span></code></pre></div>
<p>Edit: I rolled all of this functionality into a little package <a href="https://github.com/rmflight/documentNumbering"><code>documentNumbering</code></a>.</p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rmarkdowncookbook" class="csl-entry">
Xie, C; Riederer, Y; Dervieux. 2021. <span>“R Markdown Cookbook.”</span> <a href="https://bookdown.org/yihui/rmarkdown-cookbook/keep-files.html">https://bookdown.org/yihui/rmarkdown-cookbook/keep-files.html</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {Keeping {Figures} in an {Rmd} -\/- {Word} {Document}},
  date = {2021-07-22},
  url = {https://rmflight.github.io/posts/2021-07-22-keep-figures-in-a-word-document},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“Keeping Figures in an Rmd -- Word
Document.”</span> July 22, 2021. <a href="https://rmflight.github.io/posts/2021-07-22-keep-figures-in-a-word-document">https://rmflight.github.io/posts/2021-07-22-keep-figures-in-a-word-document</a>.
</div></div></section></div> ]]></description>
  <category>random-code-snippets</category>
  <category>reproducibility</category>
  <category>rmarkdown</category>
  <guid>https://rmflight.github.io/posts/2021-07-22-keep-figures-in-a-word-document/index.html</guid>
  <pubDate>Thu, 22 Jul 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>My Geographic Introduction</title>
  <dc:creator>Robert M Flight</dc:creator>
  <link>https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index.html</link>
  <description><![CDATA[ 




<p>I thought the recent animated map at Piping Hot Data {<span class="citation" data-cites="pileggi2021gganimating">Pileggi (2021)</span>} was a really neat way to demonstrate where someone has lived and what their various experiences may have been (while acknowledging that we are also more than the sum of where we have lived of course), so I thought I would take a go at creating my own, which includes stints in various parts of Canada, a stint in Germany, as well as two moves within Kentucky.</p>
<p>I’ll start by getting all of the locations, as well as my time at each one. I had to add the year dates so I could get the number of years correct, as my initial try I was missing 6 years. Now I’m only missing 1.5, which isn’t bad if we are using years as our unit of time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tibble)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(gganimate)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(extrafont)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(ggtext)</span>
<span id="cb1-6">residence <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">tribble</span>(</span>
<span id="cb1-7"><span class="sc" style="color: #5E5E5E;">~</span>city,           <span class="sc" style="color: #5E5E5E;">~</span>state,  <span class="sc" style="color: #5E5E5E;">~</span>lat,   <span class="sc" style="color: #5E5E5E;">~</span>long, <span class="sc" style="color: #5E5E5E;">~</span>years, <span class="sc" style="color: #5E5E5E;">~</span>description, <span class="sc" style="color: #5E5E5E;">~</span>dates,</span>
<span id="cb1-8"><span class="st" style="color: #20794D;">"Brandon"</span>,  <span class="st" style="color: #20794D;">"MB"</span>, <span class="fl" style="color: #AD0000;">49.8485</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">99.9501</span>, <span class="fl" style="color: #AD0000;">2.5</span>, <span class="st" style="color: #20794D;">"Born"</span>, <span class="st" style="color: #20794D;">"1979-1982"</span>,</span>
<span id="cb1-9"><span class="st" style="color: #20794D;">"Lahr"</span>,     <span class="st" style="color: #20794D;">"Baden-Württemberg"</span>, <span class="fl" style="color: #AD0000;">48.3392</span>, <span class="fl" style="color: #AD0000;">7.8781</span>, <span class="dv" style="color: #AD0000;">6</span>, <span class="st" style="color: #20794D;">"Childhood"</span>, <span class="st" style="color: #20794D;">"1982-1988"</span>,</span>
<span id="cb1-10"><span class="st" style="color: #20794D;">"Oromocto"</span>, <span class="st" style="color: #20794D;">"NB"</span>, <span class="fl" style="color: #AD0000;">45.8487</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">66.4813</span>, <span class="dv" style="color: #AD0000;">4</span>, <span class="st" style="color: #20794D;">"Childhood"</span>, <span class="st" style="color: #20794D;">"1988-1992"</span>,</span>
<span id="cb1-11"><span class="st" style="color: #20794D;">"Victoria"</span>, <span class="st" style="color: #20794D;">"BC"</span>, <span class="fl" style="color: #AD0000;">48.4284</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">123.3656</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Childhood"</span>, <span class="st" style="color: #20794D;">"1992-1993"</span>,</span>
<span id="cb1-12"><span class="st" style="color: #20794D;">"Burton"</span>, <span class="st" style="color: #20794D;">"NB"</span>, <span class="fl" style="color: #AD0000;">45.8752</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">66.3611</span>, <span class="dv" style="color: #AD0000;">9</span>, <span class="st" style="color: #20794D;">"Childhood&lt;br&gt;Undergrad at UNB"</span>, <span class="st" style="color: #20794D;">"1993-2002"</span>,</span>
<span id="cb1-13"><span class="st" style="color: #20794D;">"Fredericton"</span>, <span class="st" style="color: #20794D;">"NB"</span>, <span class="fl" style="color: #AD0000;">45.9636</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">66.6431</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">"Masters at UNB"</span>, <span class="st" style="color: #20794D;">"2002-2004"</span>,</span>
<span id="cb1-14"><span class="st" style="color: #20794D;">"Halifax"</span>, <span class="st" style="color: #20794D;">"NS"</span>, <span class="fl" style="color: #AD0000;">44.6488</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">63.5752</span>, <span class="dv" style="color: #AD0000;">5</span>, <span class="st" style="color: #20794D;">"PhD at Dalhousie"</span>, <span class="st" style="color: #20794D;">"2004-2009"</span>,</span>
<span id="cb1-15"><span class="st" style="color: #20794D;">"Louisville"</span>, <span class="st" style="color: #20794D;">"KY"</span>, <span class="fl" style="color: #AD0000;">38.2527</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">85.7585</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="st" style="color: #20794D;">"PostDoc at UofL"</span>, <span class="st" style="color: #20794D;">"2010-2012"</span>,</span>
<span id="cb1-16"><span class="st" style="color: #20794D;">"Lexington"</span>, <span class="st" style="color: #20794D;">"KY"</span>, <span class="fl" style="color: #AD0000;">38.0406</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">84.5037</span>, <span class="dv" style="color: #AD0000;">9</span>, <span class="st" style="color: #20794D;">"PostDoc at UK&lt;br&gt;Research Associate at UK"</span>, <span class="st" style="color: #20794D;">"2012-2021"</span></span>
<span id="cb1-17">)</span></code></pre></div>
</div>
<p>I created a function from Shannon’s original code because I end up using it twice, and I was missing all of the variables I needed to change to make it work properly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">create_connections <span class="ot" style="color: #003B4F;">=</span> <span class="cf" style="color: #003B4F;">function</span>(residence){</span>
<span id="cb2-2">  residence_connections_prelim <span class="ot" style="color: #003B4F;">=</span> residence <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb2-4">    <span class="co" style="color: #5E5E5E;"># need this to create transition state ----</span></span>
<span id="cb2-5">    <span class="at" style="color: #657422;">city_order =</span> <span class="fu" style="color: #4758AB;">row_number</span>() <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;"># where I moved to next, for curved arrows ----</span></span>
<span id="cb2-7">    <span class="at" style="color: #657422;">lat_next =</span> <span class="fu" style="color: #4758AB;">lead</span>(lat),</span>
<span id="cb2-8">    <span class="at" style="color: #657422;">long_next =</span> <span class="fu" style="color: #4758AB;">lead</span>(long),</span>
<span id="cb2-9">    <span class="co" style="color: #5E5E5E;"># label to show in plot, styled using ggtext ---</span></span>
<span id="cb2-10">    <span class="at" style="color: #657422;">label =</span> glue<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"**{city}, {state}** ({years} yrs)&lt;br&gt;*{description}*"</span>),</span>
<span id="cb2-11">    <span class="co" style="color: #5E5E5E;"># label of next location ----</span></span>
<span id="cb2-12">    <span class="at" style="color: #657422;">label_next =</span> <span class="fu" style="color: #4758AB;">lead</span>(label)</span>
<span id="cb2-13">  ) </span>
<span id="cb2-14">  n_entry <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">nrow</span>(residence_connections_prelim)</span>
<span id="cb2-15">residence_connections <span class="ot" style="color: #003B4F;">=</span> residence_connections_prelim <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-16">  <span class="co" style="color: #5E5E5E;"># get first row of residence ----</span></span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;">slice</span>(<span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-18">  <span class="co" style="color: #5E5E5E;"># manually modify for plotting ----</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb2-20">    <span class="at" style="color: #657422;">city_order =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb2-21">    <span class="at" style="color: #657422;">label_next =</span> label,</span>
<span id="cb2-22">    <span class="at" style="color: #657422;">lat_next =</span> lat,</span>
<span id="cb2-23">    <span class="at" style="color: #657422;">long_next =</span> long,</span>
<span id="cb2-24">    ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-25">  <span class="co" style="color: #5E5E5E;"># combine with all other residences ----</span></span>
<span id="cb2-26">  <span class="fu" style="color: #4758AB;">bind_rows</span>(residence_connections_prelim) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-27">  <span class="co" style="color: #5E5E5E;"># last (9th) row irrelevant ----</span></span>
<span id="cb2-28">  <span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> n_entry) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-29">  <span class="co" style="color: #5E5E5E;"># keep what we neeed ----</span></span>
<span id="cb2-30">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">select</span>(city_order, lat, long, lat_next, long_next, label_next)</span>
<span id="cb2-31">  residence_connections</span>
<span id="cb2-32">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">world_data <span class="ot" style="color: #003B4F;">=</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">map_data</span>(<span class="st" style="color: #20794D;">"world"</span>)</span>
<span id="cb3-2">trim_world <span class="ot" style="color: #003B4F;">=</span> world_data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(long <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">130</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> long <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">20</span>, lat <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">35</span>, lat <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">70</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_polygon</span>(<span class="at" style="color: #657422;">data =</span> trim_world, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>long, <span class="at" style="color: #657422;">y =</span> lat, <span class="at" style="color: #657422;">group =</span> group)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;">coord_fixed</span>(<span class="fl" style="color: #AD0000;">1.3</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/get_world_data_trim-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>OK, at least that looks like the right region that I want to use. Basically from British Columbia to Germany, and the northern part of North America.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">base_map <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-2">  <span class="co" style="color: #5E5E5E;"># plot states ----</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">geom_polygon</span>(</span>
<span id="cb4-4">    <span class="at" style="color: #657422;">data =</span> trim_world,</span>
<span id="cb4-5">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb4-6">      <span class="at" style="color: #657422;">x     =</span> long, </span>
<span id="cb4-7">      <span class="at" style="color: #657422;">y     =</span> lat, </span>
<span id="cb4-8">      <span class="at" style="color: #657422;">group =</span> group</span>
<span id="cb4-9">      ),</span>
<span id="cb4-10">    <span class="at" style="color: #657422;">fill  =</span> <span class="st" style="color: #20794D;">"#F2F2F2"</span>,</span>
<span id="cb4-11">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span></span>
<span id="cb4-12">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-13">  <span class="co" style="color: #5E5E5E;"># lines for pins ----</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;">geom_segment</span>(</span>
<span id="cb4-15">    <span class="at" style="color: #657422;">data =</span> residence,</span>
<span id="cb4-16">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb4-17">      <span class="at" style="color: #657422;">x    =</span> long,</span>
<span id="cb4-18">      <span class="at" style="color: #657422;">xend =</span> long,</span>
<span id="cb4-19">      <span class="at" style="color: #657422;">y    =</span> lat,</span>
<span id="cb4-20">      <span class="at" style="color: #657422;">yend =</span> lat <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb4-21">      ),</span>
<span id="cb4-22">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#181818"</span>,</span>
<span id="cb4-23">    <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.3</span></span>
<span id="cb4-24">    ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-25">    <span class="co" style="color: #5E5E5E;"># pin heads, a bit above actual location, color with R ladies lighter purple ----</span></span>
<span id="cb4-26">  <span class="fu" style="color: #4758AB;">geom_point</span>(</span>
<span id="cb4-27">    <span class="at" style="color: #657422;">data =</span> residence,</span>
<span id="cb4-28">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb4-29">      <span class="at" style="color: #657422;">x =</span> long, </span>
<span id="cb4-30">      <span class="at" style="color: #657422;">y =</span> lat <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb4-31">      ),</span>
<span id="cb4-32">    <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb4-33">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#88398A"</span></span>
<span id="cb4-34">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-35">  <span class="fu" style="color: #4758AB;">theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-36">  <span class="fu" style="color: #4758AB;">coord_fixed</span>(<span class="fl" style="color: #AD0000;">1.3</span>)</span>
<span id="cb4-37">base_map</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/pin_labels-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">res_connections <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">create_connections</span>(residence)</span>
<span id="cb5-2">n_res <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">nrow</span>(res_connections)</span>
<span id="cb5-3">anim <span class="ot" style="color: #003B4F;">=</span> base_map <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-4">  <span class="co" style="color: #5E5E5E;"># show arrows connecting residences ----</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">geom_curve</span>(</span>
<span id="cb5-6">    <span class="co" style="color: #5E5E5E;"># do not include 1st residence in arrows as no arrow is intended ----</span></span>
<span id="cb5-7">    <span class="co" style="color: #5E5E5E;"># and inclusion messes up transition ---</span></span>
<span id="cb5-8">    <span class="at" style="color: #657422;">data =</span> res_connections <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">slice</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb5-9">    <span class="co" style="color: #5E5E5E;"># add slight adjustment to arrow positioning ----</span></span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb5-11">      <span class="at" style="color: #657422;">y     =</span> lat <span class="sc" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb5-12">      <span class="at" style="color: #657422;">x     =</span> long,</span>
<span id="cb5-13">      <span class="at" style="color: #657422;">yend  =</span> lat_next <span class="sc" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.2</span>,</span>
<span id="cb5-14">      <span class="at" style="color: #657422;">xend  =</span> long_next,</span>
<span id="cb5-15">      <span class="co" style="color: #5E5E5E;"># group is used to create the transition ----</span></span>
<span id="cb5-16">      <span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">seq_along</span>(city_order)</span>
<span id="cb5-17">    ),</span>
<span id="cb5-18">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#181818"</span>,</span>
<span id="cb5-19">    <span class="at" style="color: #657422;">curvature =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb5-20">    <span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="fl" style="color: #AD0000;">0.02</span>, <span class="st" style="color: #20794D;">"npc"</span>)),</span>
<span id="cb5-21">    <span class="at" style="color: #657422;">size  =</span> <span class="fl" style="color: #AD0000;">0.2</span></span>
<span id="cb5-22">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-23">  <span class="co" style="color: #5E5E5E;"># add in labels for pins, with inward positioning ----</span></span>
<span id="cb5-24">  <span class="co" style="color: #5E5E5E;"># show labels either top left or top right of pin ----</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;">geom_richtext</span>(</span>
<span id="cb5-26">    <span class="at" style="color: #657422;">data =</span> res_connections,</span>
<span id="cb5-27">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb5-28">      <span class="at" style="color: #657422;">x     =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(long_next <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">100</span>, long_next <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>, long_next <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb5-29">      <span class="at" style="color: #657422;">y     =</span> lat_next <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb5-30">      <span class="at" style="color: #657422;">label =</span> label_next,</span>
<span id="cb5-31">      <span class="at" style="color: #657422;">vjust =</span> <span class="st" style="color: #20794D;">"top"</span>,</span>
<span id="cb5-32">      <span class="at" style="color: #657422;">hjust =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(long_next <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb5-33">      <span class="co" style="color: #5E5E5E;"># group is used to create the transition ----</span></span>
<span id="cb5-34">      <span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">seq_along</span>(city_order)</span>
<span id="cb5-35">    ),</span>
<span id="cb5-36">    <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb5-37">    <span class="at" style="color: #657422;">label.colour =</span> <span class="st" style="color: #20794D;">"white"</span>,</span>
<span id="cb5-38">    <span class="co" style="color: #5E5E5E;"># R ladies purple ----</span></span>
<span id="cb5-39">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#562457"</span>,</span>
<span id="cb5-40">    <span class="co" style="color: #5E5E5E;"># R ladies font used in xaringan theme ----</span></span>
<span id="cb5-41">    <span class="at" style="color: #657422;">family =</span> <span class="st" style="color: #20794D;">"Lato"</span></span>
<span id="cb5-42">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-43">  <span class="co" style="color: #5E5E5E;"># title determined by group value in transition ----</span></span>
<span id="cb5-44">  <span class="fu" style="color: #4758AB;">ggtitle</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"Home {closest_state} of "</span>, n_res)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-45">  <span class="co" style="color: #5E5E5E;"># create animation ----</span></span>
<span id="cb5-46">  <span class="fu" style="color: #4758AB;">transition_states</span>(</span>
<span id="cb5-47">    city_order,</span>
<span id="cb5-48">    <span class="at" style="color: #657422;">transition_length =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb5-49">    <span class="at" style="color: #657422;">state_length =</span> <span class="dv" style="color: #AD0000;">5</span></span>
<span id="cb5-50">    ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-51">  <span class="co" style="color: #5E5E5E;"># style title ----</span></span>
<span id="cb5-52">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb5-53">    <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(</span>
<span id="cb5-54">      <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#562457"</span>,</span>
<span id="cb5-55">      <span class="at" style="color: #657422;">family =</span> <span class="st" style="color: #20794D;">"Permanent Marker"</span>,</span>
<span id="cb5-56">      <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">12</span></span>
<span id="cb5-57">      )</span>
<span id="cb5-58">    )</span>
<span id="cb5-59"><span class="co" style="color: #5E5E5E;"># render and save transition ----</span></span>
<span id="cb5-60"><span class="co" style="color: #5E5E5E;"># the default nframes 100 frames, 150 makes the gif a bit longer for readability ----</span></span>
<span id="cb5-61"><span class="co" style="color: #5E5E5E;"># changing dimensions for output w/ height &amp; width ----</span></span>
<span id="cb5-62"><span class="co" style="color: #5E5E5E;"># increasing resolution with res ----</span></span>
<span id="cb5-63"><span class="fu" style="color: #4758AB;">animate</span>(anim, <span class="at" style="color: #657422;">nframes =</span> <span class="dv" style="color: #AD0000;">150</span>, <span class="at" style="color: #657422;">height =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">width =</span> <span class="dv" style="color: #AD0000;">3</span>, <span class="at" style="color: #657422;">units =</span> <span class="st" style="color: #20794D;">"in"</span>, <span class="at" style="color: #657422;">res =</span> <span class="dv" style="color: #AD0000;">150</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/animate_it-1.gif" class="img-fluid"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">anim_save</span>(<span class="st" style="color: #20794D;">"homes_animation.gif"</span>)</span></code></pre></div>
</div>
<p>That’s not bad! The only issue with it is that because of the crossing of the Atlantic Ocean, the travels within North America, especially the very close travels from NB to NS, and then within KY are way too crushed together.</p>
<p>So lets see what happens if we trim to the region of North America, and remove the overseas trip to Germany.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">trim_world2 <span class="ot" style="color: #003B4F;">=</span> world_data <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(long <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">130</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> long <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">60</span>, lat <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">35</span>, lat <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="dv" style="color: #AD0000;">70</span>)</span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_polygon</span>(<span class="at" style="color: #657422;">data =</span> trim_world2, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>long, <span class="at" style="color: #657422;">y =</span> lat, <span class="at" style="color: #657422;">group =</span> group)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;">coord_fixed</span>(<span class="fl" style="color: #AD0000;">1.3</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/trim_na-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">residence2 <span class="ot" style="color: #003B4F;">=</span> residence <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Lahr"</span>, city))</span>
<span id="cb8-3">res_connections2 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">create_connections</span>(residence2)</span>
<span id="cb8-4">n_res2 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">nrow</span>(res_connections2)</span>
<span id="cb8-5">base_map2 <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-6">  <span class="co" style="color: #5E5E5E;"># plot states ----</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">geom_polygon</span>(</span>
<span id="cb8-8">    <span class="at" style="color: #657422;">data =</span> trim_world2,</span>
<span id="cb8-9">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb8-10">      <span class="at" style="color: #657422;">x     =</span> long, </span>
<span id="cb8-11">      <span class="at" style="color: #657422;">y     =</span> lat, </span>
<span id="cb8-12">      <span class="at" style="color: #657422;">group =</span> group</span>
<span id="cb8-13">      ),</span>
<span id="cb8-14">    <span class="at" style="color: #657422;">fill  =</span> <span class="st" style="color: #20794D;">"#F2F2F2"</span>,</span>
<span id="cb8-15">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span></span>
<span id="cb8-16">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-17">  <span class="co" style="color: #5E5E5E;"># lines for pins ----</span></span>
<span id="cb8-18">  <span class="fu" style="color: #4758AB;">geom_segment</span>(</span>
<span id="cb8-19">    <span class="at" style="color: #657422;">data =</span> residence2,</span>
<span id="cb8-20">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb8-21">      <span class="at" style="color: #657422;">x    =</span> long,</span>
<span id="cb8-22">      <span class="at" style="color: #657422;">xend =</span> long,</span>
<span id="cb8-23">      <span class="at" style="color: #657422;">y    =</span> lat,</span>
<span id="cb8-24">      <span class="at" style="color: #657422;">yend =</span> lat <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb8-25">      ),</span>
<span id="cb8-26">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#181818"</span>,</span>
<span id="cb8-27">    <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.3</span></span>
<span id="cb8-28">    ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-29">    <span class="co" style="color: #5E5E5E;"># pin heads, a bit above actual location, color with R ladies lighter purple ----</span></span>
<span id="cb8-30">  <span class="fu" style="color: #4758AB;">geom_point</span>(</span>
<span id="cb8-31">    <span class="at" style="color: #657422;">data =</span> residence2,</span>
<span id="cb8-32">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb8-33">      <span class="at" style="color: #657422;">x =</span> long, </span>
<span id="cb8-34">      <span class="at" style="color: #657422;">y =</span> lat <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb8-35">      ),</span>
<span id="cb8-36">    <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb8-37">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#88398A"</span></span>
<span id="cb8-38">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-39">  <span class="fu" style="color: #4758AB;">theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-40">  <span class="fu" style="color: #4758AB;">coord_fixed</span>(<span class="fl" style="color: #AD0000;">1.3</span>)</span>
<span id="cb8-41">base_map2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/base_map2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">anim2 <span class="ot" style="color: #003B4F;">=</span> base_map2 <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-2">  <span class="co" style="color: #5E5E5E;"># show arrows connecting residences ----</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">geom_curve</span>(</span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;"># do not include 1st residence in arrows as no arrow is intended ----</span></span>
<span id="cb9-5">    <span class="co" style="color: #5E5E5E;"># and inclusion messes up transition ---</span></span>
<span id="cb9-6">    <span class="at" style="color: #657422;">data =</span> res_connections2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">slice</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb9-7">    <span class="co" style="color: #5E5E5E;"># add slight adjustment to arrow positioning ----</span></span>
<span id="cb9-8">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb9-9">      <span class="at" style="color: #657422;">y     =</span> lat <span class="sc" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb9-10">      <span class="at" style="color: #657422;">x     =</span> long,</span>
<span id="cb9-11">      <span class="at" style="color: #657422;">yend  =</span> lat_next <span class="sc" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.2</span>,</span>
<span id="cb9-12">      <span class="at" style="color: #657422;">xend  =</span> long_next,</span>
<span id="cb9-13">      <span class="co" style="color: #5E5E5E;"># group is used to create the transition ----</span></span>
<span id="cb9-14">      <span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">seq_along</span>(city_order)</span>
<span id="cb9-15">    ),</span>
<span id="cb9-16">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#181818"</span>,</span>
<span id="cb9-17">    <span class="at" style="color: #657422;">curvature =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb9-18">    <span class="at" style="color: #657422;">arrow =</span> <span class="fu" style="color: #4758AB;">arrow</span>(<span class="at" style="color: #657422;">length =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="fl" style="color: #AD0000;">0.02</span>, <span class="st" style="color: #20794D;">"npc"</span>)),</span>
<span id="cb9-19">    <span class="at" style="color: #657422;">size  =</span> <span class="fl" style="color: #AD0000;">0.2</span></span>
<span id="cb9-20">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-21">  <span class="co" style="color: #5E5E5E;"># add in labels for pins, with inward positioning ----</span></span>
<span id="cb9-22">  <span class="co" style="color: #5E5E5E;"># show labels either top left or top right of pin ----</span></span>
<span id="cb9-23">  <span class="fu" style="color: #4758AB;">geom_richtext</span>(</span>
<span id="cb9-24">    <span class="at" style="color: #657422;">data =</span> res_connections2,</span>
<span id="cb9-25">    <span class="fu" style="color: #4758AB;">aes</span>(</span>
<span id="cb9-26">      <span class="at" style="color: #657422;">x     =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(long_next <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">100</span>, long_next <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>, long_next <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb9-27">      <span class="at" style="color: #657422;">y     =</span> lat_next <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb9-28">      <span class="at" style="color: #657422;">label =</span> label_next,</span>
<span id="cb9-29">      <span class="at" style="color: #657422;">vjust =</span> <span class="st" style="color: #20794D;">"top"</span>,</span>
<span id="cb9-30">      <span class="at" style="color: #657422;">hjust =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(long_next <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb9-31">      <span class="co" style="color: #5E5E5E;"># group is used to create the transition ----</span></span>
<span id="cb9-32">      <span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">seq_along</span>(city_order)</span>
<span id="cb9-33">    ),</span>
<span id="cb9-34">    <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb9-35">    <span class="at" style="color: #657422;">label.colour =</span> <span class="st" style="color: #20794D;">"white"</span>,</span>
<span id="cb9-36">    <span class="co" style="color: #5E5E5E;"># R ladies purple ----</span></span>
<span id="cb9-37">    <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#562457"</span>,</span>
<span id="cb9-38">    <span class="co" style="color: #5E5E5E;"># R ladies font used in xaringan theme ----</span></span>
<span id="cb9-39">    <span class="at" style="color: #657422;">family =</span> <span class="st" style="color: #20794D;">"Lato"</span></span>
<span id="cb9-40">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-41">  <span class="co" style="color: #5E5E5E;"># title determined by group value in transition ----</span></span>
<span id="cb9-42">  <span class="fu" style="color: #4758AB;">ggtitle</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"Home {closest_state} of "</span>, n_res2)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-43">  <span class="co" style="color: #5E5E5E;"># create animation ----</span></span>
<span id="cb9-44">  <span class="fu" style="color: #4758AB;">transition_states</span>(</span>
<span id="cb9-45">    city_order,</span>
<span id="cb9-46">    <span class="at" style="color: #657422;">transition_length =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb9-47">    <span class="at" style="color: #657422;">state_length =</span> <span class="dv" style="color: #AD0000;">5</span></span>
<span id="cb9-48">    ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-49">  <span class="co" style="color: #5E5E5E;"># style title ----</span></span>
<span id="cb9-50">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb9-51">    <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(</span>
<span id="cb9-52">      <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"#562457"</span>,</span>
<span id="cb9-53">      <span class="at" style="color: #657422;">family =</span> <span class="st" style="color: #20794D;">"Permanent Marker"</span>,</span>
<span id="cb9-54">      <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">12</span></span>
<span id="cb9-55">      )</span>
<span id="cb9-56">    )</span>
<span id="cb9-57"><span class="co" style="color: #5E5E5E;"># render and save transition ----</span></span>
<span id="cb9-58"><span class="co" style="color: #5E5E5E;"># the default nframes 100 frames, 150 makes the gif a bit longer for readability ----</span></span>
<span id="cb9-59"><span class="co" style="color: #5E5E5E;"># changing dimensions for output w/ height &amp; width ----</span></span>
<span id="cb9-60"><span class="co" style="color: #5E5E5E;"># increasing resolution with res ----</span></span>
<span id="cb9-61"><span class="fu" style="color: #4758AB;">animate</span>(anim2, <span class="at" style="color: #657422;">nframes =</span> <span class="dv" style="color: #AD0000;">150</span>, <span class="at" style="color: #657422;">height =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">width =</span> <span class="dv" style="color: #AD0000;">3</span>, <span class="at" style="color: #657422;">units =</span> <span class="st" style="color: #20794D;">"in"</span>, <span class="at" style="color: #657422;">res =</span> <span class="dv" style="color: #AD0000;">150</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index_files/figure-html/animate_it2-1.gif" class="img-fluid"></p>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;">anim_save</span>(<span class="st" style="color: #20794D;">"homes_animation2.gif"</span>)</span></code></pre></div>
</div>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-pileggi2021gganimating" class="csl-entry">
Pileggi, Shannon. 2021. <span>“PIPING HOT DATA: GGanimating a Geographic Introduction.”</span> <a href="https://www.pipinghotdata.com/posts/2021-02-15-gganimating-a-geographic-introduction/">https://www.pipinghotdata.com/posts/2021-02-15-gganimating-a-geographic-introduction/</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{mflight2021,
  author = {Robert M Flight},
  title = {My {Geographic} {Introduction}},
  date = {2021-05-02},
  url = {https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-mflight2021" class="csl-entry quarto-appendix-citeas">
Robert M Flight. 2021. <span>“My Geographic Introduction.”</span> May 2,
2021. <a href="https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction">https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction</a>.
</div></div></section></div> ]]></description>
  <category>maps</category>
  <category>graphing</category>
  <category>visualization</category>
  <category>animation</category>
  <guid>https://rmflight.github.io/posts/2021-05-02-animating-a-geographic-introduction/index.html</guid>
  <pubDate>Sun, 02 May 2021 04:00:00 GMT</pubDate>
</item>
</channel>
</rss>
