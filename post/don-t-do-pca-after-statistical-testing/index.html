<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="author" content="Robert M Flight">
  <meta name="description" content="Senior Research Associate in Bioinformatics">

  
  <link rel="alternate" hreflang="en-us" href="/post/don-t-do-pca-after-statistical-testing/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Deciphering Life: One Bit at a Time">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Deciphering Life: One Bit at a Time">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/don-t-do-pca-after-statistical-testing/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@rmflight">
  <meta property="twitter:creator" content="@rmflight">
  
  <meta property="og:site_name" content="Deciphering Life: One Bit at a Time">
  <meta property="og:url" content="/post/don-t-do-pca-after-statistical-testing/">
  <meta property="og:title" content="Don&#39;t do PCA After Statistical Testing! | Deciphering Life: One Bit at a Time">
  <meta property="og:description" content="">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-09-14T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-09-14T00:00:00&#43;00:00">
  

  

  <title>Don&#39;t do PCA After Statistical Testing! | Deciphering Life: One Bit at a Time</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" class="dark">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Deciphering Life: One Bit at a Time</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>About</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">Don&#39;t do PCA After Statistical Testing!</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-09-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      2018-09-14
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Don%27t%20do%20PCA%20After%20Statistical%20Testing%21&amp;url=%2fpost%2fdon-t-do-pca-after-statistical-testing%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fdon-t-do-pca-after-statistical-testing%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fdon-t-do-pca-after-statistical-testing%2f&amp;title=Don%27t%20do%20PCA%20After%20Statistical%20Testing%21"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fdon-t-do-pca-after-statistical-testing%2f&amp;title=Don%27t%20do%20PCA%20After%20Statistical%20Testing%21"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Don%27t%20do%20PCA%20After%20Statistical%20Testing%21&amp;body=%2fpost%2fdon-t-do-pca-after-statistical-testing%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        


<div id="tldr" class="section level2">
<h2>TL;DR</h2>
<p>If you do a statistical test <strong>before</strong> a dimensional reduction method like
PCA, the highest source of variance is likely to be whatever you tested
statistically.</p>
</div>
<div id="wait-why" class="section level2">
<h2>Wait, Why??</h2>
<p>Let me describe the situation. You’ve done an <code>-omics</code> level analysis on your
system of interest. You run a t-test (or ANOVA, etc) on each of the features
in your data (gene, protein, metabolite, etc). Filter down to those things that
were statistically significant, and then finally, you decide to look at the data
using a dimensionality reduction method such as <em>principal components analysis</em>
(PCA) so you can <strong>see</strong> what is going on.</p>
<p>I have seen this published at least once (in a Diabetes metabolomics paper,
if anyone knows it, please send it to me so I can link it), and have seen
collaborators do this after coaching from others in non-statistical departments.</p>
</div>
<div id="the-problem" class="section level2">
<h2>The Problem</h2>
<p>The problem is that PCA is just looking at either feature-feature covariances
or sample-sample covariances. If you have trimmed the data to those things that
have statistically significant differences, then you have completely modified
the covariances, and PCA is likely to pick up on that.</p>
</div>
<div id="an-example" class="section level2">
<h2>An Example</h2>
<p>Let’s actually do an example where there are no differences initially, and
then see if we can introduce an artificial difference.</p>
<div id="random-data" class="section level3">
<h3>Random Data</h3>
<p>We start with completely random data, 10000 features, and 100 samples.</p>
<pre class="r"><code>n_feat = 10000
n_sample = 100
random_data = matrix(rnorm(n_feat * n_sample), nrow = n_feat, ncol = n_sample)</code></pre>
<p>Now we will do a t-test on each row, taking the first 50 samples as class 1
and the other 50 samples as class 2.</p>
<pre class="r"><code>t_test_res = purrr::map_df(seq(1, nrow(random_data)), function(in_row){
  tidy(t.test(random_data[in_row, 1:50], random_data[in_row, 51:100]))
})</code></pre>
<p>How many are significant at a p-value of 0.05?</p>
<pre class="r"><code>filter(t_test_res, p.value &lt;= 0.05) %&gt;% dim()</code></pre>
<pre><code>## [1] 514  10</code></pre>
<p>Obviously, these are false positives, but they are enough for us to illustrate
the problem.</p>
<p>First, lets do PCA on the whole data set of 10000 features.</p>
<pre class="r"><code>sample_classes = data.frame(class = c(rep(&quot;A&quot;, 50), rep(&quot;B&quot;, 50)))

all_pca = prcomp(t(random_data), center = TRUE, scale. = FALSE)
visqc_pca(all_pca, groups = sample_classes$class)</code></pre>
<p><img src="/post/2018-09-14-don-t-do-pca-after-statistical-testing_files/figure-html/all_pca-1.png" width="672" /></p>
<p>Obviously, there is no difference in the groups, and the % explained variance
is very low.</p>
<p>Second, lets do it on just those things that were significant:</p>
<pre class="r"><code>sig_pca = prcomp(t(random_data[which(t_test_res$p.value &lt;= 0.05), ]), center = TRUE,
                 scale. = FALSE)

visqc_pca(sig_pca, groups = sample_classes$class)</code></pre>
<p><img src="/post/2018-09-14-don-t-do-pca-after-statistical-testing_files/figure-html/sig_pca-1.png" width="672" /></p>
<p>And look at that! We have separation of the two groups! But …., this is
completely random data, that didn’t have any separation, <strong>until we did the
statistical test</strong>!</p>
</div>
</div>
<div id="take-away" class="section level2">
<h2>Take Away</h2>
<p>Be careful of the order in which you do things. If you want to do dimensionality
reduction to look for issues with the samples, then do that <strong>before</strong> any statistical
testing on the individual features.</p>
</div>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/pca">pca</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/bioinformatics">bioinformatics</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/finding-modes-using-kernel-density-estimates/">Finding Modes Using Kernel Density Estimates</a></li>
    
    <li><a href="/post/split-unsplit-anti-pattern/">Split - Unsplit Anti-Pattern</a></li>
    
    <li><a href="/post/iranges-for-non-integer-overlaps/">Using IRanges for Non-Integer Overlaps</a></li>
    
    <li><a href="/post/knitrprogressbar/">knitrProgressBar Package</a></li>
    
    <li><a href="/post/licensing-r-packages-that-include-others-code/">Licensing R Packages that Include Others Code</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Robert M Flight &middot; 

      Powered by
      <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">Blogdown</a>, and the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <br>
      The source of this site is available from <a href="https://github.com/rmflight/researchBlog_blogdown">here</a>. The content from my previous site <br>is all <a href="https://github.com/rmflight/researchBlog">here</a>, in case I haven't posted something on the new one.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

