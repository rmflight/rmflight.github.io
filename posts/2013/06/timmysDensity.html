<!DOCTYPE html><html><head><title>Tim Hortons Density</title><meta charset="utf-8"><meta content="width=device-width, initiali-scale=1.0, user-scalable=yes" name="viewport"><link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="/css/smartphone.css" media="only screen and (max-device-width:480px)" rel="stylesheet" type="text/css"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                           m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43966261-1', 'rmflight.github.io');
ga('send', 'pageview');

</script><!-- Styles for R syntax highlighter -->
  <style type="text/css">
  pre .operator,
pre .paren {
  color: rgb(104, 118, 135)
}

pre .literal {
  color: rgb(88, 72, 246)
}

pre .number {
  color: rgb(0, 0, 205);
}

pre .comment {
  color: rgb(76, 136, 107);
}

pre .keyword {
  color: rgb(0, 0, 255);
}

pre .identifier {
  color: rgb(0, 0, 0);
}

pre .string {
  color: rgb(3, 106, 7);
}
</style>
  
  <!-- R syntax highlighter -->
  <script type="text/javascript">
  var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>
  <script>
  window.Krux||((Krux=function(){Krux.q.push(arguments)}).q=[]);
(function(){
  var k = document.createElement('script');k.type = 'text/javascript';k.async = true;
  var m,src = (m=location.href.match(/\bkwsrc=([^&]+)\b/))&&decodeURIComponent(m[1]);
  k.src = src ||(location.protocol === "https:" ? "https:" : "http:") + 
    '//cdn.krxd.net/static/socialtag/widget.js';
  var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s); 
})();
</script></head><body><div class="container-fluid well"><h1>Deciphering life: One bit at a time</h1><p>Robert M Flight's home on the web</p></div><div class="subnav"><ul class="nav nav-pills"><li><a href="/index.html">Home</a></li><li><a href="/pages/about.html">About</a></li><li><a href="/pages/archive.html">Blog Archive</a></li><li><a href="https://github.com/rmflight/researchBlog">Blog Source</a></li><li><a href="https://github.com/rmflight?tab=repositories">Github Repos</a></li></ul></div><div class="container-fluid"><div class="row-fluid"><div class="span1"></div><div class="span9"><h1>Tim Hortons Density</h1>

<p>Inspired by this <a href="http://www.ifweassume.com/2012/10/the-united-states-of-starbucks.html">post</a>, I wanted to examine the locations and density of Tim Hortons restaurants in Canada. Using Stats Canada data, each census tract is queried on Foursquare for Tims locations.</p>

<h2>Setup</h2>

<pre><code class="r">options(stringsAsFactors = F)
require(timmysDensity)
require(plyr)
require(maps)
require(ggplot2)
require(geosphere)
</code></pre>

<h2>Statistics Canada Census Data</h2>

<p>The actual Statistics Canada data at the dissemination block level can be downloaded from <a href="http://www.data.gc.ca/default.asp?lang=En&amp;n=5175A6F0-1&amp;xsl=datacataloguerecord&amp;metaxsl=datacataloguerecord&amp;formid=C87D5FDD-00E6-41A0-B5BA-E8E41B521ED0">here</a>. You will want to download the Excel format, read it, and then save it as either tab-delimited or CSV using a non-standard delimiter, I used a semi-colon (;).</p>

<pre><code class="r">censusData &lt;- read.table(&quot;../timmysData/2011_92-151_XBB_XLSX.csv&quot;, header = F, 
    sep = &quot;;&quot;, quote = &quot;&quot;)
censusData &lt;- censusData[, 1:17]
names(censusData) &lt;- c(&quot;DBuid&quot;, &quot;DBpop2011&quot;, &quot;DBtdwell2011&quot;, &quot;DBurdwell2011&quot;, 
    &quot;DBarea&quot;, &quot;DB_ir2011&quot;, &quot;DAuid&quot;, &quot;DAlamx&quot;, &quot;DAlamy&quot;, &quot;DAlat&quot;, &quot;DAlong&quot;, &quot;PRuid&quot;, 
    &quot;PRname&quot;, &quot;PRename&quot;, &quot;PRfname&quot;, &quot;PReabbr&quot;, &quot;PRfabbr&quot;)
censusData$DBpop2011 &lt;- as.numeric(censusData$DBpop2011)
censusData$DBpop2011[is.na(censusData$DBpop2011)] &lt;- 0

censusData$DBtdwell2011 &lt;- as.numeric(censusData$DBtdwell2011)
censusData$DBtdwell2011[is.na(censusData$DBtdwell2011)] &lt;- 0
</code></pre>

<p>From this data we get block level:</p>

<ul>
<li>populations (DBpop2011)</li>
<li>total private dwellings (DBtdwell2011)</li>
<li>privale dwellings occupied by usual residents (DBurdwell2011)</li>
<li>block land area (DBarea)</li>
<li>dissemination area id (DAuid)</li>
<li>representative point x coordinate in Lambert projection (DAlamx)</li>
<li>rep. point y coordinate in Lambert projection (DAlamy)</li>
<li>rep. point latitude (DAlat)</li>
<li>rep. point longitude (DAlong)</li>
</ul>

<p>This should be everything we need to do the investigation we want.</p>

<h2>Dissemination Area Long. and Lat.</h2>

<p>We need to find the unique dissemination areas, and get out their latitudes and longitudes for querying in other databases. Note that the longitude and latitude provided here actually are weighted representative locations based on population. However, given the size of them, I don&#39;t think using them will be a problem for <code>Foursquare</code>. Because areas are what we have location data for, we will summarize everything at the area level, summing the population counts for all the blocks within an area.</p>

<pre><code class="r">uniqAreas &lt;- unique(censusData$DAuid)

summarizeArea &lt;- function(areaID) {
    areaData &lt;- censusData[(censusData$DAuid == areaID), ]
    outData &lt;- data.frame(uid = areaID, lamx = areaData[1, &quot;DAlamx&quot;], lamy = areaData[1, 
        &quot;DAlamy&quot;], lat = areaData[1, &quot;DAlat&quot;], long = areaData[1, &quot;DAlong&quot;], 
        pop = sum(areaData[, &quot;DBpop2011&quot;]), dwell = sum(areaData[, &quot;DBtdwell2011&quot;]), 
        prov = areaData[1, &quot;PRename&quot;])
    return(outData)
}
areaData &lt;- adply(uniqAreas, 1, summarizeArea)
.sessionInfo &lt;- sessionInfo()
.timedate &lt;- Sys.time()
write.table(areaData, file = &quot;../timmysData/areaData.txt&quot;, sep = &quot;\t&quot;, row.names = F, 
    col.names = T)
save(areaData, .sessionInfo, .timedate, file = &quot;../timmysData/areaDataFile.RData&quot;, 
    compress = &quot;xz&quot;)
</code></pre>

<h2>Run queries on Foursquare</h2>

<h3>Load up the data and verify what we have.</h3>

<pre><code class="r">load(&quot;../timmysData/areaDataFile.RData&quot;)
head(areaData)
</code></pre>

<h3>Generate queries and run</h3>

<p>For each dissemination area (DA), we are going to use as the location for the query the latitude and longitude of each DA, as well as the search string &ldquo;tim horton&rdquo;. </p>

<p>Because Foursquare limits the number of userless requests to <a href="https://developer.foursquare.com/overview/ratelimits">5000 / hr</a>. To make sure we stay under this limit, the <code>runQueries</code> function will only 5000 queries an hour.</p>

<pre><code class="r">runQueries(areaData, idFile = &quot;../timmysData/clientid.txt&quot;, secretFile = &quot;../timmysData/clientsecret.txt&quot;, 
    outFile = &quot;../timmysData/timmysLocs2.txt&quot;)
</code></pre>

<h3>Clean up the results</h3>

<p>Due to the small size of the DAs, we have a lot of duplicate entries. Now lets remove all the duplicate entries.</p>

<pre><code class="r">cleanUpResults(&quot;../timmysData/timmysLocs2.txt&quot;)
</code></pre>

<h2>Visualize Locations</h2>

<p>First lets read in the data and make sure that we have Tims locations.</p>

<pre><code class="r"># read in and clean up the data
timsLocs &lt;- scan(file = &quot;../timmysData/timmysLocs2.txt&quot;, what = character(), 
    sep = &quot;\n&quot;)
timsLocs &lt;- strsplit(timsLocs, &quot;:&quot;)

timsName &lt;- sapply(timsLocs, function(x) {
    x[1]
})
timsLat &lt;- sapply(timsLocs, function(x) {
    x[2]
})
timsLong &lt;- sapply(timsLocs, function(x) {
    x[3]
})

locData &lt;- data.frame(description = timsName, lat = as.numeric(timsLat), long = as.numeric(timsLong))
hasNA &lt;- is.na(locData[, &quot;lat&quot;]) | is.na(locData[, &quot;long&quot;])
locData &lt;- locData[!(hasNA), ]

timsStr &lt;- c(&quot;tim hortons&quot;, &quot;tim horton&#39;s&quot;)

hasTims &lt;- (grepl(timsStr[1], locData$description, ignore.case = T)) | (grepl(timsStr[2], 
    locData$description, ignore.case = T))

locData &lt;- locData[hasTims, ]
timsLocs &lt;- locData
rm(timsName, timsLat, timsLong, hasNA, locData, hasTims, timsStr)
.timedate &lt;- Sys.time()
.sessionInfo &lt;- sessionInfo()
save(timsLocs, .timedate, .sessionInfo, file = &quot;../timmysData/timsLocs.RData&quot;, 
    compress = &quot;xz&quot;)
</code></pre>

<h3>Put them on a map</h3>

<pre><code class="r">data(timsLocs)
data(areaDataFile)
canada &lt;- map_data(&quot;world&quot;, &quot;canada&quot;)

p &lt;- ggplot(legend = FALSE) + geom_polygon(data = canada, aes(x = long, y = lat, 
    group = group)) + theme(panel.background = element_blank()) + theme(panel.grid.major = element_blank()) + 
    theme(panel.grid.minor = element_blank()) + theme(axis.text.x = element_blank(), 
    axis.text.y = element_blank()) + theme(axis.ticks = element_blank()) + xlab(&quot;&quot;) + 
    ylab(&quot;&quot;)

sp &lt;- timsLocs[1, c(&quot;lat&quot;, &quot;long&quot;)]

p2 &lt;- p + geom_point(data = timsLocs[, c(&quot;lat&quot;, &quot;long&quot;)], aes(x = long, y = lat), 
    colour = &quot;green&quot;, size = 1, alpha = 0.5)

print(p2)
</code></pre>

<p><img src="/mlab/data/rmflight/Documents/researchBlog/researchBlog/img/mapIt.png" alt="plot of chunk mapIt"/> </p>

<h3>How far??</h3>

<p>And now lets also calculate the minimum distance of a given DA from Timmys locations.</p>

<pre><code class="r">queryLocs &lt;- matrix(c(timsLocs$long, timsLocs$lat), nrow = nrow(timsLocs), ncol = 2, 
    byrow = F)  # these are the tims locations
distLocs &lt;- matrix(c(areaData$long, areaData$lat), nrow = nrow(areaData), ncol = 2, 
    byrow = F)  # the census centers
allDists &lt;- apply(queryLocs, 1, function(x) {
    min(distHaversine(x, distLocs))  # only need the minimum value to determine 
})
</code></pre>

<p>From the <code>allDists</code> variable above, we can determine that the maximum distance any census dissemination area (DA) is from a Tim Hortons is 51.5 km (31.9815 miles). This is based on distances calculated &ldquo;as the crow flies&rdquo;, but still, that is pretty close. Assuming roads, the furthest a Canadian should have to travel is less than an hour to get their Timmys fix. </p>

<pre><code class="r">totPopulation &lt;- sum(areaData$pop, na.rm = T)
lessDist &lt;- seq(50, 51.6 * 1000, 50)  # distances are in meters, so multiply by 1000 to get reasonable km

percPop &lt;- sapply(lessDist, function(inDist) {
    isLess &lt;- allDists &lt; inDist
    sum(areaData$pop[isLess], na.rm = T)/totPopulation * 100
})

plotDistPerc &lt;- data.frame(distance = lessDist, population = percPop, logDist = log10(lessDist))
ggplot(plotDistPerc, aes(x = logDist, y = population)) + geom_point() + xlab(&quot;Log10 Distance&quot;) + 
    ylab(&quot;% Population&quot;)
</code></pre>

<p><img src="/mlab/data/rmflight/Documents/researchBlog/researchBlog/img/percPopulation.png" alt="plot of chunk percPopulation"/> </p>

<p>What gets really interesting, is how much of the population lives within a given distance of a Timmys. By summing up the percentage of the population within given distances. The plot above shows that 50% of the population is within 316.2278 <strong>meters</strong> of a Tim Hortons location. </p>

<p>I guess Canadians really do like their Tim Hortons Coffee (and donuts!).</p>

<h2>Replication</h2>

<p>All of the necessary processed data and code is available in the <code>R</code> package <a href="https://github.com/rmflight/timmysDensity"><code>timmysDensity</code></a>. You can install it using <code>devtools</code>. The original data files are linked in the relevant sections above.</p>

<pre><code class="r">library(devtools)
install_github(&quot;timmysDensity&quot;, &quot;rmflight&quot;)
</code></pre>

<h3>Caveats</h3>

<p>I originally did this work based on a different set of data, that I have not been able to locate the original source for. I have not compared these results to that data to verify their accuracy. When I do so, I will update the package, vignette and blog post.</p>

<h2>Posted</h2>

<p>This work exists as the vignette of <a href="https://github.com/rmflight/timmysDensity"><code>timmysDensity</code></a>, on my <a href="http://rmflight.github.io/posts/2013/06/timmysDensity.html">web-blog</a>, and independently as the front page for the <a href="http://rmflight.github.io/timmysDensity">GitHub repo</a>.</p>

<h2>Disclaimer</h2>

<p>Tim Hortons was not involved in the creation or preparation of this work. I am not regularly updating the location information obtained from Foursquare, it is only valid for May 31, 2013. All code used in preparing these results was written by me, except in the case where code from other <code>R</code> packages was used. All opinions and conclusions are my own, and do not reflect the views of anyone else or any institution I may be associated with.</p>

<h2>Other information when this vignette was generated</h2>

<h3>Session Info</h3>

<pre><code class="r">sessionInfo()
</code></pre>

<pre><code>## R version 3.0.0 (2013-04-03)
## Platform: x86_64-unknown-linux-gnu (64-bit)
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=C                 LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] tools     stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] geosphere_1.2-28    sp_1.0-11           ggplot2_0.9.3.1    
##  [4] maps_2.3-2          plyr_1.8            timmysDensity_0.0.6
##  [7] samatha_0.3         XML_3.98-1.1        RJSONIO_1.0-3      
## [10] markdown_0.6.1      knitr_1.3           stringr_0.6.2      
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.2-2   dichromat_2.0-0    digest_0.6.3      
##  [4] evaluate_0.4.4     formatR_0.8        grid_3.0.0        
##  [7] gtable_0.1.2       labeling_0.2       lattice_0.20-15   
## [10] lubridate_1.3.0    MASS_7.3-27        munsell_0.4.2     
## [13] proto_0.3-10       RColorBrewer_1.0-5 RCurl_1.95-4.1    
## [16] reshape2_1.2.2     scales_0.2.3
</code></pre>

<h3>Time and Date</h3>

<pre><code class="r">Sys.time()
</code></pre>

<pre><code>## [1] &quot;2013-09-16 14:02:57 EDT&quot;
</code></pre>
<h6>Posted on 2013-06-05</h6><a href="https://twitter.com/share" class="twitter-share-button" data-via="rmflight" data-size="large">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><div id="disqus_thread"></div>
  <script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'decipheringlife'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><div class="span2"><a class="twitter-timeline" href="https://twitter.com/rmflight" data-widget-id="368415899268558848">Tweets by @rmflight</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<h3>Tags</h3><ul><li><a href="/tags/R.html">R (11)</a></li><li><a href="/tags/openscience.html">openscience (3)</a></li><li><a href="/tags/reproducibility.html">reproducibility (2)</a></li><li><a href="/tags/tutorial.html">tutorial (2)</a></li><li><a href="/tags/science.html">science (2)</a></li><li><a href="/tags/hiveplot.html">hiveplot (1)</a></li><li><a href="/tags/cytoscape.html">cytoscape (1)</a></li><li><a href="/tags/literateprogramming.html">literateprogramming (1)</a></li><li><a href="/tags/writing.html">writing (1)</a></li><li><a href="/tags/package.html">package (1)</a></li><li><a href="/tags/timhortons.html">timhortons (1)</a></li><li><a href="/tags/mapping.html">mapping (1)</a></li><li><a href="/tags/teaching.html">teaching (1)</a></li><li><a href="/tags/notebook.html">notebook (1)</a></li><li><a href="/tags/moving.html">moving (2)</a></li><li><a href="/tags/setup.html">setup (1)</a></li><li><a href="/tags/Samatha.html">Samatha (3)</a></li><li><a href="/tags/twitter.html">twitter (1)</a></li><li><a href="/tags/bioconductor.html">bioconductor (1)</a></li><li><a href="/tags/rstudio.html">rstudio (1)</a></li><li><a href="/tags/postdoc.html">postdoc (1)</a></li><li><a href="/tags/academia.html">academia (1)</a></li><li><a href="/tags/packages.html">packages (1)</a></li><li><a href="/tags/precalculate.html">precalculate (1)</a></li><li><a href="/tags/hpc.html">hpc (1)</a></li><li><a href="/tags/python.html">python (1)</a></li></ul><h3>Blog Roll</h3><ul><li><a href="http://www.r-bloggers.com/">R bloggers</a></li><li><a href="http://ivory.idyll.org/blog/">Living in an Ivory Basement</a></li><li><a href="http://bytesizebio.net/">Byte Size Biology</a></li><li><a href="http://robjhyndman.com/hyndsight/">Hyndsight</a></li><li><a href="http://solomonmessing.wordpress.com/blog/">Solomon Messing</a></li><li><a href="http://nsaunders.wordpress.com/">What You're Doing Is Rather Desperate</a></li><li><a href="http://yihui.name/en/">Yihui Xie's Blog</a></li><li><a href="http://simplystatistics.org/">Simply Statistics</a></li><li><a href="http://software-carpentry.org/">Software carpentry</a></li></ul></div></div><div class="span12"><div class="span2"></div><div class="span8"><footer class="footer"><p class="right back_to_top"><a href="#">&uArr; Page Top</a></p><p><a href="https://github.com/DASpringate/samatha">Built in R with Samatha</a></p></footer></div></div></div></body></html>